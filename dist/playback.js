!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=4)}([function(e,t,s){"use strict";(function(e){var r=s(3),n=s.n(r);const o=s(5);t.a={load:function(t){return new Promise(function(s,r){t.startsWith(".")||t.startsWith("/")||(t=o.join(e,"../../styles/",t+".play")),n.a.readFile(t,"utf8",(e,t)=>{e?r(e):s(t)})})}}}).call(this,"src/loader")},function(e,t){var s,r;s=this,r=function(){function e(t,s,r){return this.id=++e.highestId,this.name=t,this.symbols=s,this.postprocess=r,this}function t(e,t,s,r){this.rule=e,this.dot=t,this.reference=s,this.data=[],this.wantedBy=r,this.isComplete=this.dot===e.symbols.length}function s(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function r(e,t){this.rules=e,this.start=t||this.rules[0].name;var s=this.byName={};this.rules.forEach(function(e){s.hasOwnProperty(e.name)||(s[e.name]=[]),s[e.name].push(e)})}function n(){this.reset("")}function o(e,t,o){if(e instanceof r){var i=e;o=t}else i=r.fromCompiled(e,t);for(var a in this.grammar=i,this.options={keepHistory:!1,lexer:i.lexer||new n},o||{})this.options[a]=o[a];this.lexer=this.options.lexer,this.lexerState=void 0;var l=new s(i,0);this.table=[l];l.wants[i.start]=[],l.predict(i.start),l.process(),this.current=0}return e.highestId=0,e.prototype.toString=function(e){function t(e){return e.literal?JSON.stringify(e.literal):e.type?"%"+e.type:e.toString()}var s=void 0===e?this.symbols.map(t).join(" "):this.symbols.slice(0,e).map(t).join(" ")+" ● "+this.symbols.slice(e).map(t).join(" ");return this.name+" → "+s},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var s=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return s.left=this,s.right=e,s.isComplete&&(s.data=s.build()),s},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,o.fail))},s.prototype.process=function(e){for(var t=this.states,s=this.wants,r=this.completed,n=0;n<t.length;n++){var i=t[n];if(i.isComplete){if(i.finish(),i.data!==o.fail){for(var a=i.wantedBy,l=a.length;l--;){var c=a[l];this.complete(c,i)}if(i.reference===this.index){var p=i.rule.name;(this.completed[p]=this.completed[p]||[]).push(i)}}}else{if("string"!=typeof(p=i.rule.symbols[i.dot])){this.scannable.push(i);continue}if(s[p]){if(s[p].push(i),r.hasOwnProperty(p)){var u=r[p];for(l=0;l<u.length;l++){var m=u[l];this.complete(i,m)}}}else s[p]=[i],this.predict(p)}}},s.prototype.predict=function(e){for(var s=this.grammar.byName[e]||[],r=0;r<s.length;r++){var n=s[r],o=this.wants[e],i=new t(n,0,this.index,o);this.states.push(i)}},s.prototype.complete=function(e,t){var s=e.nextState(t);this.states.push(s)},r.fromCompiled=function(t,s){var n=t.Lexer;t.ParserStart&&(s=t.ParserStart,t=t.ParserRules);var o=new r(t=t.map(function(t){return new e(t.name,t.symbols,t.postprocess)}),s);return o.lexer=n,o},n.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},n.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},n.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},n.prototype.formatError=function(e,t){var s=this.buffer;if("string"==typeof s){var r=s.indexOf("\n",this.index);-1===r&&(r=s.length);var n=s.substring(this.lastLineBreak,r),o=this.index-this.lastLineBreak;return t+=" at line "+this.line+" col "+o+":\n\n",t+="  "+n+"\n",t+="  "+Array(o).join(" ")+"^"}return t+" at index "+(this.index-1)},o.fail={},o.prototype.feed=function(e){var t,r=this.lexer;for(r.reset(e,this.lexerState);t=r.next();){var o=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var i=this.current+1,a=new s(this.grammar,i);this.table.push(a);for(var l=t.value,c=r.constructor===n?t.value:t,p=o.scannable,u=p.length;u--;){var m=p[u],h=m.rule.symbols[m.dot];if(h.test?h.test(c):h.type?h.type===t.type:h.literal===l){var f=m.nextState({data:c,token:t,isToken:!0,reference:i-1});a.states.push(f)}}if(a.process(),0===a.states.length){var $=this.lexer.formatError(t,"invalid syntax")+"\n";$+="Unexpected "+(t.type?t.type+" token: ":""),$+=JSON.stringify(void 0!==t.value?t.value:t)+"\n";var b=new Error($);throw b.offset=this.current,b.token=t,b}this.options.keepHistory&&(o.lexerState=r.save()),this.current++}return o&&(this.lexerState=r.save()),this.results=this.finish(),this},o.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},o.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},o.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},o.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach(function(s){s.rule.name===t&&s.dot===s.rule.symbols.length&&0===s.reference&&s.data!==o.fail&&e.push(s)}),e.map(function(e){return e.data})},{Parser:o,Grammar:r,Rule:e}},"object"==typeof e&&e.exports?e.exports=r():s.nearley=r()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty,assign="function"==typeof Object.assign?Object.assign:function(e,t){if(null==e)throw new TypeError("Target cannot be null or undefined");e=Object(e);for(var s=1;s<arguments.length;s++){var r=arguments[s];if(null!=r)for(var n in r)hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hasSticky="boolean"==typeof(new RegExp).sticky;function isRegExp(e){return e&&e.constructor===RegExp}function isObject(e){return e&&"object"==typeof e&&e.constructor!==RegExp&&!Array.isArray(e)}function reEscape(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function reGroups(e){var t=new RegExp("|"+e);return t.exec("").length-1}function reCapture(e){return"("+e+")"}function reUnion(e){var t=e.map(function(e){return"(?:"+e+")"}).join("|");return"(?:"+t+")"}function regexpOrLiteral(e){if("string"==typeof e)return"(?:"+reEscape(e)+")";if(isRegExp(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("not a pattern: "+e)}function objectToRules(e){for(var t=Object.getOwnPropertyNames(e),s=[],r=0;r<t.length;r++){var n=t[r],o=e[n],i=Array.isArray(o)?o:[o],a=[];i.forEach(function(e){isObject(e)?(a.length&&s.push(ruleOptions(n,a)),s.push(ruleOptions(n,e)),a=[]):a.push(e)}),a.length&&s.push(ruleOptions(n,a))}return s}function arrayToRules(e){for(var t=[],s=0;s<e.length;s++){var r=e[s];if(!r.name)throw new Error("Rule has no name: "+JSON.stringify(r));t.push(ruleOptions(r.name,r))}return t}function ruleOptions(e,t){("object"!=typeof t||Array.isArray(t)||isRegExp(t))&&(t={match:t});var s=assign({tokenType:e,lineBreaks:!!t.error,pop:!1,next:null,push:null,error:!1,value:null,getType:null},t),r=s.match;return s.match=Array.isArray(r)?r:r?[r]:[],s.match.sort(function(e,t){return isRegExp(e)&&isRegExp(t)?0:isRegExp(t)?-1:isRegExp(e)?1:t.length-e.length}),s.keywords&&(s.getType=keywordTransform(s.keywords)),s}function compileRules(e,t){e=Array.isArray(e)?arrayToRules(e):objectToRules(e);for(var s=null,r=[],n=[],o=0;o<e.length;o++){var i=e[o];if(i.error){if(s)throw new Error("Multiple error rules not allowed: (for token '"+i.tokenType+"')");s=i}if(0!==i.match.length){r.push(i);var a=reUnion(i.match.map(regexpOrLiteral)),l=new RegExp(a);if(l.test(""))throw new Error("RegExp matches empty string: "+l);var c=reGroups(a);if(c>0)throw new Error("RegExp has capture groups: "+l+"\nUse (?: … ) instead");if(!t&&(i.pop||i.push||i.next))throw new Error("State-switching options are not allowed in stateless lexers (for token '"+i.tokenType+"')");if(!i.lineBreaks&&l.test("\n"))throw new Error("Rule should declare lineBreaks: "+l);n.push(reCapture(a))}}var p=hasSticky?"":"|(?:)",u=hasSticky?"ym":"gm",m=new RegExp(reUnion(n)+p,u);return{regexp:m,groups:r,error:s}}function compile(e){var t=compileRules(e);return new Lexer({start:t},"start")}function compileStates(e,t){var s=Object.getOwnPropertyNames(e);t||(t=s[0]);for(var r=Object.create(null),n=0;n<s.length;n++){var o=s[n];r[o]=compileRules(e[o],!0)}for(var n=0;n<s.length;n++)for(var i=r[s[n]].groups,a=0;a<i.length;a++){var l=i[a],c=l&&(l.push||l.next);if(c&&!r[c])throw new Error("Missing state '"+c+"' (in token '"+l.tokenType+"' of state '"+s[n]+"')");if(l&&l.pop&&1!=+l.pop)throw new Error("pop must be 1 (in token '"+l.tokenType+"' of state '"+s[n]+"')")}return new Lexer(r,t)}function keywordTransform(map){for(var reverseMap=Object.create(null),byLength=Object.create(null),types=Object.getOwnPropertyNames(map),i=0;i<types.length;i++){var tokenType=types[i],item=map[tokenType],keywordList=Array.isArray(item)?item:[item];keywordList.forEach(function(e){if((byLength[e.length]=byLength[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+tokenType+"')");reverseMap[e]=tokenType})}function str(e){return JSON.stringify(e)}var source="";for(var length in source+="(function(value) {\n",source+="switch (value.length) {\n",byLength){var keywords=byLength[length];source+="case "+length+":\n",source+="switch (value) {\n",keywords.forEach(function(e){var t=reverseMap[e];source+="case "+str(e)+": return "+str(t)+"\n"}),source+="}\n"}return source+="}\n",source+="})",eval(source)}var Lexer=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};function tokenToString(){return this.value}if(Lexer.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.setState(t?t.state:this.startState),this},Lexer.prototype.save=function(){return{line:this.line,col:this.col,state:this.state}},Lexer.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error||{lineBreaks:!0,shouldThrow:!0},this.re=t.regexp}},Lexer.prototype.popState=function(){this.setState(this.stack.pop())},Lexer.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)},Lexer.prototype._eat=hasSticky?function(e){return e.exec(this.buffer)}:function(e){var t=e.exec(this.buffer);return 0===t[0].length?null:t},Lexer.prototype._getGroup=function(e){if(null===e)return-1;for(var t=this.groups.length,s=0;s<t;s++)if(void 0!==e[s+1])return s;throw new Error("oops")},Lexer.prototype.next=function(){var e=this.re,t=this.buffer,s=e.lastIndex=this.index;if(s!==t.length){var r,n,o=this._eat(e),i=this._getGroup(o);-1===i?(r=this.error,n=t.slice(s)):(n=o[0],r=this.groups[i]);var a=0;if(r.lineBreaks){var l=/\n/g,c=1;if("\n"===n)a=1;else for(;l.exec(n);)a++,c=l.lastIndex}var p={type:r.getType&&r.getType(n)||r.tokenType,value:r.value?r.value(n):n,text:n,toString:tokenToString,offset:s,lineBreaks:a,line:this.line,col:this.col},u=n.length;if(this.index+=u,this.line+=a,0!==a?this.col=u-c+1:this.col+=u,r.shouldThrow)throw new Error(this.formatError(p,"invalid syntax"));return r.pop?this.popState():r.push?this.pushState(r.push):r.next&&this.setState(r.next),p}},"undefined"!=typeof Symbol&&Symbol.iterator){var LexerIterator=function(e){this.lexer=e};LexerIterator.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},LexerIterator.prototype[Symbol.iterator]=function(){return this},Lexer.prototype[Symbol.iterator]=function(){return new LexerIterator(this)}}return Lexer.prototype.formatError=function(e,t){var s=e.value,r=e.offset,n=e.lineBreaks?s.indexOf("\n"):s.length,o=Math.max(0,r-e.col+1),i=this.buffer.substring(o,r+n);return t+=" at line "+e.line+" col "+e.col+":\n\n",t+="  "+i+"\n",t+="  "+Array(e.col).join(" ")+"^"},Lexer.prototype.clone=function(){return new Lexer(this.states,this.state)},Lexer.prototype.has=function(e){for(var t in this.states)for(var s=this.states[t].groups,r=0;r<s.length;r++){var n=s[r];if(n.tokenType===e)return!0;if(n.keywords&&hasOwnProperty.call(n.keywords,e))return!0}return!1},{compile:compile,states:compileStates,error:Object.freeze({error:!0})}})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t){e.exports=require("fs")},function(e,t,s){"use strict";s.r(t);var r=s(0),n=s(1),o=s.n(n),i=s(2),a=s.n(i).a.states({main:{comment:{match:/\/\/.*?(?:\n|$)/,lineBreaks:!0},quoted_string:/"(?:[^\\"\n]|\\.)*"/,ws:{match:/\s+/,lineBreaks:!0},at_rule:["@meta","@options","@import","@track","@pattern"],identifier:{match:/[a-zA-z](?:[a-zA-Z\-\d]*[a-zA-Z\d])?/,keywords:{keyword:["if","as"],boolean:["true","false"]}},number:/(?:\d*\.)?\d+/,brackets:["{","}","(",")"],left_angle:{match:"<",push:"beat"},operators:["&","+","-","*","/","."]},beat:{beat_ws:/ +/,beat_colon:":",beat_number:/(?:\d*\.)?\d+/,beat_flag:/[a-zA-Z]/,beat_right_angle:{match:">",pop:!0},beat_operators:["|","+","-","*","/"]}});let l=Symbol("Nil"),c=function(e){return e!==l&&!1!==e},p=Symbol("AwaitingDrum");class u{constructor(e){this.time=e.time,this.pitch=e.pitch,this.duration=e.duration,this.volume=e.volume}}class m extends Array{constructor(){super(),this.push(...arguments)}}class h extends Error{constructor(e,t){super(`${e}\nScope: "${t.name}"`)}}class f extends h{constructor(){super(...arguments)}}class $ extends f{constructor(e,t){super(`No style with the name "${e}" was imported`,t)}}class b extends f{constructor(e,t,s){super(`No track with the name "${t}" exists in the style "${e}"`,s)}}class y extends h{constructor(e,t){super(`No function exists with name "${e}"`,t)}}class _ extends h{constructor(e,t){super(e,t)}}class d extends h{constructor(e,t){super(e,t)}}class x extends h{constructor(e){super('Pattern may only contain 1 BeatGroup. Try the join operator "&"',e)}}class g extends h{constructor(e){super("Unexpected Melodic Beat in a Drum Beat Group",e)}}class w extends h{constructor(e){super("Unexpected Drum Beat in a Melodic Beat Group",e)}}class E{constructor(){this.vars=new Map,this.name=null,this.type=null,this.scope=null}init(e){this.scope=e,this.vars=new Map([...this.scope.vars,...this.vars])}}class v extends E{constructor(e){super(),this.name="@meta",this.type="@meta",this.function_calls=e}init(e){this.scope=e;for(let e of this.function_calls)e.init(this),e.execute();e.meta=this.vars}}class P extends E{constructor(e){super(),this.name="@options",this.type="@options",this.function_calls=e}init(e){for(let e of this.function_calls)e.init(this),e.execute();this.scope=e,e.vars=new Map([...e.vars,...this.vars])}}class k{constructor(e,t){this.path=e,this.identifier=t}}let L=new Map;function S(e,t,s,r){if("*"!=s){if(t.length!=s.length)throw new d(`"${e}" requires ${s.length} arguments.`,r);for(let n in t){if("*"==s[n])continue;let o=t[n];if(o instanceof B){if("*"==(o=o.returns))continue;if("string"==typeof s[n]){if(o!=s[n])throw new d(`Argument ${Number(n)+1} of "${e}" must be a ${s[n]}.`,r)}else if(o!=s[n])throw new d(`Argument ${Number(n)+1} of "${e}" must be a ${s[n].name}.`,r)}else if("string"==typeof s[n]){if(typeof o!=s[n])throw new d(`Argument ${Number(n)+1} of "${e}" must be a ${s[n]}.`,r)}else if(!(o instanceof s[n]))throw new d(`Argument ${Number(n)+1} of "${e}" must be a ${s[n].name}.`,r)}}}let C=function(e,t,s){let r={types:t.types||"*",returns:t.returns||"*",scope:t.scope||"no-meta",execute:(e,t)=>{return s(e,t,e=>{throw new d(e,t)})}};L.set(e,r)},A=function(e,t,s=null){C(e,{types:[t],scope:s,returns:l},(t,s,r)=>(s.vars.set(e,t[0]),l))},T=function(e,t=null){C(e,{types:"*",scopes:t,returns:l},(t,s,r)=>(t.length?(S(e,t,["boolean"],s),s.vars.set(e,t[0])):s.vars.set(e,!0),l))};A("name","string","meta"),A("author","string","meta"),A("description","string","meta"),A("playback-version","number","meta"),C("time-signature",{types:["number","number"],scope:"options",returns:l},(e,t,s)=>(Number.isInteger(Math.log2(e[1]))||s('Argument 2 of "time-signature" must be a power of 2.'),t.vars.set("time-signature",[e[0],e[1]]),l)),T("swing","options"),C("volume",{types:["number"],scope:"no-meta",returns:l},(e,t,s)=>((e[0]<0||e[0]>1)&&s('Argument 1 of "volume" must be in range 0-1 (inclusive).'),t.vars.set("volume",e[0]),l)),T("invertible","no-meta"),A("octave","number","no-meta"),C("choose",{types:"*",scope:"no-config",returns:"*"},(e,t,s)=>{let r=e.filter(e=>e!==l);if(r.length){return r[Math.floor(Math.random()*r.length)]}return l}),C("progression",{types:"*",scope:"no-config",returns:"boolean"},(e,t,s)=>!0),C("in-scale",{types:"*",scope:"no-config",returns:"boolean"},(e,t,s)=>!1),T("private","pattern"),A("length","number","pattern"),C("chance",{types:["number"],scope:"pattern",returns:l},(e,t,s)=>((e[0]<0||e[0]>1)&&s('Argument 1 of "chance" must be in range 0-1 (inclusive).'),t.vars.set("chance",e[0]),l));class B{constructor(e,t){this.identifier=e,this.definition=L.get(e),this.args=t,this.scope=null}init(e){if(this.scope=e,!this.definition)throw new y(this.identifier,this.scope);this.returns=this.definition.returns,function(e,t="no-meta",s){if("meta"==t){if("@meta"!=s.type)throw new _(`Function "${e}" must only be called within a @meta block."`,s)}else if("options"==t){if("@options"!=s.type)throw new _(`Function "${e}" must only be called within an @options block."`,s)}else if("no-config"==t){if("@meta"==s.type||"@options"==s.type)throw new _(`Function "${e}" must not be called within a @meta or @options block."`,s)}else if("pattern"==t){if("PatternExpressionGroup"!=s.type)throw new _(`Function "${e}" must only be called within a @pattern block."`,s)}else if("no-meta"==t&&"@meta"==s.type)throw new _(`Function "${e}" must not be called within a @meta block."`,s)}(this.identifier,this.definition.scope,this.scope),this.args.forEach(t=>{t.init&&t.init(e)}),S(this.identifier,this.args,this.definition.types,this.scope)}link(e,t,s){this.args.forEach(r=>{r.link&&r.link(e,t,s)})}execute(e){if(!this.scope)throw new Error("function not initialized :(");let t=this.args.map(t=>t.execute?t.execute(e):t),s=this.definition.execute(t,this.scope);if(void 0===s)throw new Error(`Function "${this.identifier}" can return undefined`);return s}}class M{constructor(e,t){this.drum=e,this.beatGroup=t}init(e){this.scope=e,this.beatGroup.init&&this.beatGroup.init(e)}link(){}execute(e){let t=this.beatGroup.execute(e);for(let e of t){if(e.pitch!==p)throw new g(this.scope);e.pitch=this.drum}return t}}class N extends E{constructor(e){super(),this.type="PatternExpressionGroup",this.name="@pattern(<anonymous>)",this.vars.set("private",!1),this.vars.set("chance",1),this.expressions=e,this.function_calls=[],this.non_function_call_expressions=[]}init(e,t=null){super.init(e),this.patternStatement=t,this.patternStatement&&(this.name=`@pattern(${this.patternStatement})`),this.expressions.forEach(e=>{if(!e.init)throw["expression not initialized:",e];e.init(this),e instanceof B?this.function_calls.push(e):this.non_function_call_expressions.push(e)})}link(e,t,s){this.expressions.forEach(r=>{r.link(e,t,s)})}execute(e,t=!1){let s=l;for(let t of this.function_calls){let r=t.execute(e);if(r instanceof m){if(s!==l)throw new x(this);s=r}}if(t&&!0===this.vars.get("private"))return l;for(let t of this.non_function_call_expressions)if(t.execute&&(t=t.execute(e)),t instanceof m){if(s!==l)throw new x(this);s=t}return s}}class F extends N{constructor(e){e.expression instanceof N?super(e.expression.expressions):super([e.expression]),this.identifier=e.identifier,this.condition=void 0!==e.condition?e.condition:null}getChance(){return this.vars.get("chance")}link(e,t,s){super.link(e,t,s),this.condition&&this.condition.link&&this.condition.link(e,t,s)}init(e){super.init(e),this.condition&&this.condition.init&&this.condition.init(this)}execute(e,t){if(this.condition){let e=this.condition.execute();if(!1===c(e))return l}return super.execute(e,t)}}class O{constructor(e){this.import=e.import||null,this.track=e.track||null,this.pattern=e.pattern,this.scope=null,this.patternStatement=null,this.prettyprintname=(this.import||"this")+"."+(this.track||"this")+"."+this.pattern}getChance(){return this.patternStatement.getChance()()}init(e){this.scope=e}link(e,t,s){let r,n;if(null===this.import)r=t;else{let s=t.importedStyles.get(this.import);if(!(r=e.get(s)))throw new NoSuchStyleError(this.import,this)}if(null===this.track)n=s;else if(!(n=r.tracks.get(this.track)))throw new NoSuchTrackError(this.import||"this",this.track||"this",this);let o=n.patterns.get(this.pattern);if(!o)throw new NoSuchPatternError(this.import||"this",this.track||"this",this.pattern,this);this.patternStatement=o}execute(e){return this.patternStatement.execute(e)}}class R extends E{constructor(e){super(),this.name=e.identifier,this.type="@track",this.instrument=e.instrument,this.identifier=e.identifier,this.members=e.members}init(e){super.init(e),this.function_calls=[],this.patterns=new Map,this.patternCalls=[],this.members.forEach(e=>{e.init(this),e instanceof B?this.function_calls.push(e):e instanceof F?this.patterns.set(e.identifier,e):e instanceof O&&this.patternCalls.push(e)})}link(e,t){for(let s of this.patternCalls)s.link(e,t,this),this.patterns.set(s.prettyprintname,s);for(let[s,r]of this.patterns)r.link(e,t,this)}execute(e){console.log(`executing TrackStatement "${this.name}"`),this.function_calls.forEach(t=>{t.execute(e)});let t=0,s=[];for(let[r,n]of this.patterns){console.log(`- pattern "${r}":`);let o=n.execute(e,!0);if(console.log("  - Result:",o),o!==l){for(let e of o)if(e.pitch===p)throw new w(n);let e=n.getChance();s.push({noteSet:o,lower:t,upper:t+e}),t+=e}}let r=Math.random()*t;for(let e of s)if(e.lower<=r&&r<=e.upper)return console.log("  - Final result:",e.noteSet),e.noteSet;return console.log("  - Final result:",l),l}}class G{constructor(e){this.import=e.import,this.track=e.track,this.trackStatement=null}execute(e){this.trackStatement.execute(e)}}class D{constructor(){this.args=Array.prototype.slice.call(arguments)}link(e,t,s){this.args.forEach(r=>{r.link&&r.link(e,t,s)})}init(e){this.scope=e,this.args.forEach(t=>{t.init&&t.init(e)})}resolve_args(e){return this.args.map(t=>t.init?t.init(e):t)}}class I{constructor(e){this.time=e.time||{time:"auto"},this.pitch=e.pitch,this.octave=e.octave||"inherit",this.scope=null,this.parentMeasure=null,this.indexInMeasure=null}init(e,t,s){this.scope=e,this.parentMeasure=t,this.indexInMeasure=s}getTime(){return"auto"===this.time.time?this.indexInMeasure+1:this.time.time}getPitches(e){let t;switch(this.pitch.anchor){case"KEY":t=e.song.getKey();break;case"NEXT":t=e.getRelative(1)[0];break;default:t=59}return this.pitch.chord?[t,60]:[t]}getOctave(){return"inherit"===this.octave?this.scope.vars.get("octave"):this.octave}getDuration(){let e;return e=this.parentMeasure.calculateDurationAfter(this.indexInMeasure),this.time.flag,e}getVolume(){let e=this.scope.vars.get("volume");return"ACCENTED"===this.time.flag&&(e=Math.min(1,e+=.1)),e}execute(e){let t=new m,s=this.getTime(),r=this.getPitches(e),n=this.getDuration(),o=this.getVolume();for(let e of r)t.push(new u({time:s,pitch:e,duration:n,volume:o}));return t}}class j{constructor(e){this.time=e.time,this.accented=e.accented||!1,this.scope=null,this.parentMeasure=null,this.indexInMeasure=null}init(e,t,s){this.scope=e,this.parentMeasure=t,this.indexInMeasure=s}getTime(){return this.time}getDuration(){let e;return e=this.parentMeasure.calculateDurationAfter(this.indexInMeasure)}getVolume(){let e=this.scope.vars.get("volume");return this.accented&&(e=Math.min(1,e+=.1)),e}execute(e){let t=this.getTime(),s=this.getDuration(),r=this.getVolume();return new m(new u({time:t,pitch:p,duration:s,volume:r}))}}function J(e){return e[0]}var K={Lexer:a,ParserRules:[{name:"main$macrocall$2",symbols:["TopLevelStatement"]},{name:"main$macrocall$1$ebnf$1",symbols:[]},{name:"main$macrocall$1$ebnf$1$subexpression$1",symbols:["_","main$macrocall$2"],postprocess:e=>e[1][0]},{name:"main$macrocall$1$ebnf$1",symbols:["main$macrocall$1$ebnf$1","main$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"main$macrocall$1",symbols:["main$macrocall$2","main$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"main",symbols:["_?","main$macrocall$1","_?"],postprocess:e=>new class extends E{constructor(e){super(),this.name="global",this.type="global",this.statements=e}init(){this.vars.set("octave",2),this.vars.set("volume",1),this.vars.set("private",!1),this.vars.set("time-signature",[4,4]),this.vars.set("tempo",120),this.tracks=new Map,this.meta=[],this.importedStyles=new Map,this.trackCalls=[],this.dependencies=[];for(let e of this.statements)e instanceof v||e instanceof P?this.meta.push(e):e instanceof k?(this.importedStyles.set(e.identifier,e.path),this.dependencies.push(e.path)):e instanceof R?this.tracks.set(e.name,e):e instanceof G&&this.trackCalls.push(e);this.meta.forEach(e=>e.init(this)),this.tracks.forEach(e=>e.init(this))}link(e){for(let t of this.trackCalls){let s=this.importedStyles.get(t.import),r=e.get(s);if(!r)throw new $(t.import,this);let n=r.tracks.get(t.track);if(!n)throw new b(t.import,t.track,this);this.tracks.set(`${t.import}.${t.track}`,n)}for(let[t,s]of this.tracks)s.link(e,this)}execute(e){let t=new m;for(let[s,r]of this.tracks){let s=r.execute(e);s!==l&&t.push(...s)}return t}}(e[1])},{name:"TopLevelStatement",symbols:["ConfigurationStatement"],postprocess:J},{name:"TopLevelStatement",symbols:["ImportStatement"],postprocess:J},{name:"TopLevelStatement",symbols:["TrackStatement"],postprocess:J},{name:"TopLevelStatement",symbols:["TrackCallStatement"],postprocess:J},{name:"ConfigurationStatement",symbols:[{literal:"@meta"},"_?",{literal:"{"},"_?","ConfigurationList","_?",{literal:"}"}],postprocess:e=>new v(e[4])},{name:"ConfigurationStatement",symbols:[{literal:"@options"},"_?",{literal:"{"},"_?","ConfigurationList","_?",{literal:"}"}],postprocess:e=>new P(e[4])},{name:"ConfigurationList$macrocall$2",symbols:["FunctionCallExpression"]},{name:"ConfigurationList$macrocall$1$ebnf$1",symbols:[]},{name:"ConfigurationList$macrocall$1$ebnf$1$subexpression$1",symbols:["_","ConfigurationList$macrocall$2"],postprocess:e=>e[1][0]},{name:"ConfigurationList$macrocall$1$ebnf$1",symbols:["ConfigurationList$macrocall$1$ebnf$1","ConfigurationList$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ConfigurationList$macrocall$1",symbols:["ConfigurationList$macrocall$2","ConfigurationList$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"ConfigurationList",symbols:["ConfigurationList$macrocall$1"],postprocess:J},{name:"ImportStatement",symbols:[{literal:"@import"},"_","StringLiteral","_",{literal:"as"},"_","Identifier"],postprocess:e=>new k(e[2],e[6])},{name:"TrackStatement$macrocall$2",symbols:["TrackMember"]},{name:"TrackStatement$macrocall$1$ebnf$1",symbols:[]},{name:"TrackStatement$macrocall$1$ebnf$1$subexpression$1",symbols:["_","TrackStatement$macrocall$2"],postprocess:e=>e[1][0]},{name:"TrackStatement$macrocall$1$ebnf$1",symbols:["TrackStatement$macrocall$1$ebnf$1","TrackStatement$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"TrackStatement$macrocall$1",symbols:["TrackStatement$macrocall$2","TrackStatement$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"TrackStatement",symbols:[{literal:"@track"},"_","StringLiteral","_",{literal:"as"},"_","Identifier","_?",{literal:"{"},"_?","TrackStatement$macrocall$1","_?",{literal:"}"}],postprocess:e=>new R({instrument:e[2],identifier:e[6],members:e[10]})},{name:"TrackMember",symbols:["FunctionCallExpression"],postprocess:J},{name:"TrackMember",symbols:["PatternStatement"],postprocess:J},{name:"TrackMember",symbols:["PatternCallExpression"],postprocess:J},{name:"TrackCallStatement",symbols:[{literal:"@track"},"_?",{literal:"("},"_?","Identifier",{literal:"."},"Identifier","_?",{literal:")"}],postprocess:e=>new G({import:e[4],track:e[6]})},{name:"PatternStatement",symbols:[{literal:"@pattern"},"_","Identifier","_","PatternConditional","_?","PatternExpression"],postprocess:e=>new F({identifier:e[2],expression:e[6],condition:e[4]})},{name:"PatternStatement",symbols:[{literal:"@pattern"},"_","Identifier","_","PatternExpression"],postprocess:e=>new F({identifier:e[2],expression:e[4]})},{name:"PatternConditional",symbols:[{literal:"if"},"_?",{literal:"("},"_?","FunctionCallArgument","_?",{literal:")"}],postprocess:e=>e[4]},{name:"PatternExpression",symbols:["PatternExpression_NoJoin"],postprocess:J},{name:"PatternExpression",symbols:["JoinedPatternExpression"],postprocess:J},{name:"PatternExpression_NoJoin",symbols:["PatternExpressionGroup"],postprocess:J},{name:"PatternExpression_NoJoin",symbols:["BeatGroupLiteral"],postprocess:J},{name:"PatternExpression_NoJoin",symbols:["DrumBeatGroupLiteral"],postprocess:J},{name:"PatternExpression_NoJoin",symbols:["FunctionCallExpression"],postprocess:J},{name:"PatternExpression_NoJoin",symbols:["PatternCallExpression"],postprocess:J},{name:"PatternExpressionGroup$macrocall$2",symbols:["PatternExpression"]},{name:"PatternExpressionGroup$macrocall$1$ebnf$1",symbols:[]},{name:"PatternExpressionGroup$macrocall$1$ebnf$1$subexpression$1",symbols:["_","PatternExpressionGroup$macrocall$2"],postprocess:e=>e[1][0]},{name:"PatternExpressionGroup$macrocall$1$ebnf$1",symbols:["PatternExpressionGroup$macrocall$1$ebnf$1","PatternExpressionGroup$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PatternExpressionGroup$macrocall$1",symbols:["PatternExpressionGroup$macrocall$2","PatternExpressionGroup$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"PatternExpressionGroup",symbols:[{literal:"{"},"_?","PatternExpressionGroup$macrocall$1","_?",{literal:"}"}],postprocess:e=>new N(e[2])},{name:"PatternCallExpression",symbols:[{literal:"@pattern"},"_?",{literal:"("},"_?","Identifier","_?",{literal:")"}],postprocess:e=>new O({pattern:e[4]})},{name:"PatternCallExpression",symbols:[{literal:"@pattern"},"_?",{literal:"("},"_?","Identifier",{literal:"."},"Identifier","_?",{literal:")"}],postprocess:e=>new O({track:e[4],pattern:e[6]})},{name:"PatternCallExpression",symbols:[{literal:"@pattern"},"_?",{literal:"("},"_?","Identifier",{literal:"."},"Identifier",{literal:"."},"Identifier","_?",{literal:")"}],postprocess:e=>new O({import:e[4],track:e[6],pattern:e[8]})},{name:"JoinedPatternExpression$macrocall$2",symbols:["PatternExpression_NoJoin"]},{name:"JoinedPatternExpression$macrocall$3",symbols:[{literal:"&"}]},{name:"JoinedPatternExpression$macrocall$1$ebnf$1$subexpression$1",symbols:["_?","JoinedPatternExpression$macrocall$3","_?","JoinedPatternExpression$macrocall$2"],postprocess:e=>e[3][0]},{name:"JoinedPatternExpression$macrocall$1$ebnf$1",symbols:["JoinedPatternExpression$macrocall$1$ebnf$1$subexpression$1"]},{name:"JoinedPatternExpression$macrocall$1$ebnf$1$subexpression$2",symbols:["_?","JoinedPatternExpression$macrocall$3","_?","JoinedPatternExpression$macrocall$2"],postprocess:e=>e[3][0]},{name:"JoinedPatternExpression$macrocall$1$ebnf$1",symbols:["JoinedPatternExpression$macrocall$1$ebnf$1","JoinedPatternExpression$macrocall$1$ebnf$1$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"JoinedPatternExpression$macrocall$1",symbols:["JoinedPatternExpression$macrocall$2","JoinedPatternExpression$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"JoinedPatternExpression",symbols:["JoinedPatternExpression$macrocall$1"],postprocess:e=>new class{constructor(e){this.patterns=e}init(e){this.scope=e,this.patterns.forEach(t=>{t.init&&t.init(e)})}link(e,t,s){this.patterns.forEach(r=>{r.link(e,t,s)})}execute(e){let t=[];for(let s of this.patterns)s.execute&&(s=s.execute(e)),s instanceof m&&t.push(s);return t.length?(new m).concat(...t):l}}(e[0])},{name:"FunctionCallExpression$macrocall$2",symbols:["FunctionCallArgument"]},{name:"FunctionCallExpression$macrocall$1$ebnf$1",symbols:[]},{name:"FunctionCallExpression$macrocall$1$ebnf$1$subexpression$1",symbols:["_","FunctionCallExpression$macrocall$2"],postprocess:e=>e[1][0]},{name:"FunctionCallExpression$macrocall$1$ebnf$1",symbols:["FunctionCallExpression$macrocall$1$ebnf$1","FunctionCallExpression$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"FunctionCallExpression$macrocall$1",symbols:["FunctionCallExpression$macrocall$2","FunctionCallExpression$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"FunctionCallExpression",symbols:["Identifier","_?",{literal:"("},"_?","FunctionCallExpression$macrocall$1","_?",{literal:")"}],postprocess:e=>new B(e[0],e[4])},{name:"FunctionCallExpression",symbols:["Identifier","_?",{literal:"("},{literal:")"}],postprocess:e=>new B(e[0],[])},{name:"FunctionCallArgument",symbols:["NumericExpression"],postprocess:J},{name:"FunctionCallArgument",symbols:["StringLiteral"],postprocess:J},{name:"FunctionCallArgument",symbols:["BooleanLiteral"],postprocess:J},{name:"FunctionCallArgument",symbols:["PatternExpression"],postprocess:J},{name:"FunctionCallArgument",symbols:["BL_PP_Anchor"],postprocess:e=>new class{constructor(e){this.anchor=e}}(e[0])},{name:"FunctionCallArgument",symbols:[{literal:"not"},"_","FunctionCallArgument"],postprocess:e=>new class extends D{constructor(){super(arguments)}execute(e){let t=this.resolve_args(e);return!c(t[0])}}(e[2])},{name:"FunctionCallArgument",symbols:["FunctionCallArgument","_",{literal:"and"},"_","FunctionCallArgument"],postprocess:e=>new class extends D{constructor(){super(arguments)}execute(e){let t=this.resolve_args(e);return c(t[0])&&c(t[1])}}(e[0],e[4])},{name:"FunctionCallArgument",symbols:["FunctionCallArgument","_",{literal:"or"},"_","FunctionCallArgument"],postprocess:e=>new class extends D{constructor(){super(arguments)}execute(e){let t=this.resolve_args(e);return c(t[0])||c(t[1])}}(e[0],e[4])},{name:"BeatGroupLiteral",symbols:[{literal:"<"},"_?","MeasureGroup","_?",{literal:">"}],postprocess:e=>new class{constructor(e){this.measures=e,this.scope=null}init(e){this.scope=e,this.measures.forEach(t=>t.init(e))}link(){}execute(e){let t=new m;for(let s=0;s<this.measures.length;s++){let r=4*s,n=this.measures[s].execute(e);if(n===l)return l;for(let e of n)e.time+=r,t.push(e)}return t}}(e[2])},{name:"MeasureGroup$macrocall$2",symbols:["Measure"]},{name:"MeasureGroup$macrocall$3",symbols:[{literal:"|"}]},{name:"MeasureGroup$macrocall$1$ebnf$1",symbols:[]},{name:"MeasureGroup$macrocall$1$ebnf$1$subexpression$1",symbols:["_?","MeasureGroup$macrocall$3","_?","MeasureGroup$macrocall$2"],postprocess:e=>e[3][0]},{name:"MeasureGroup$macrocall$1$ebnf$1",symbols:["MeasureGroup$macrocall$1$ebnf$1","MeasureGroup$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MeasureGroup$macrocall$1",symbols:["MeasureGroup$macrocall$2","MeasureGroup$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"MeasureGroup",symbols:["MeasureGroup$macrocall$1"],postprocess:J},{name:"Measure$macrocall$2",symbols:["MelodicBeatLiteral"]},{name:"Measure$macrocall$1$ebnf$1",symbols:[]},{name:"Measure$macrocall$1$ebnf$1$subexpression$1",symbols:["_","Measure$macrocall$2"],postprocess:e=>e[1][0]},{name:"Measure$macrocall$1$ebnf$1",symbols:["Measure$macrocall$1$ebnf$1","Measure$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"Measure$macrocall$1",symbols:["Measure$macrocall$2","Measure$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"Measure",symbols:["Measure$macrocall$1"],postprocess:e=>new class{constructor(e){this.beats=e,this.beatsPerMeasure=null,this.scope=null}calculateDurationAfter(e){let t,s=this.beats[e].getTime();return(t=e+1>=this.beats.length?this.beatsPerMeasure+1:this.beats[e+1].getTime())-s}init(e){this.scope=e,this.beatsPerMeasure=this.scope.vars.get("time-signature")[0],this.beats.forEach((t,s)=>{t.init(e,this,s)})}execute(e){let t=new m;for(let s of this.beats){let r=s.execute(e);if(r===l)return l;t.push(...r)}return t}}(e[0])},{name:"MelodicBeatLiteral",symbols:["BL_TimePart",{literal:":"},"BL_PitchPart",{literal:":"},"BL_OctavePart"],postprocess:e=>new I({time:e[0],pitch:e[2],octave:e[4]})},{name:"MelodicBeatLiteral",symbols:[{literal:":"},"BL_PitchPart",{literal:":"},"BL_OctavePart"],postprocess:e=>new I({pitch:e[1],octave:e[3]})},{name:"MelodicBeatLiteral",symbols:["BL_TimePart",{literal:":"},"BL_PitchPart"],postprocess:e=>new I({time:e[0],pitch:e[2]})},{name:"MelodicBeatLiteral",symbols:[{literal:":"},"BL_PitchPart"],postprocess:e=>new I({pitch:e[1]})},{name:"MelodicBeatLiteral",symbols:["DrumBeatLiteral"],postprocess:J},{name:"BL_TimePart",symbols:["NumericExpression"],postprocess:e=>({time:e[0]})},{name:"BL_TimePart",symbols:["BL_TP_Flag"],postprocess:e=>({time:"auto",flag:e[0]})},{name:"BL_TimePart",symbols:["NumericExpression","BL_TP_Flag"],postprocess:e=>({time:e[0],flag:e[1]})},{name:"BL_TP_Flag",symbols:[{literal:"s"}],postprocess:e=>"STACCATO"},{name:"BL_TP_Flag",symbols:[{literal:"a"}],postprocess:e=>"ACCENTED"},{name:"BL_PitchPart",symbols:["BL_PP_Degree"],postprocess:J},{name:"BL_PitchPart",symbols:["BL_PP_Chord"],postprocess:J},{name:"BL_PP_Degree",symbols:["NumberLiteral"],postprocess:e=>({degree:e[0]})},{name:"BL_PP_Degree",symbols:["BL_PP_Anchor"],postprocess:e=>({anchor:e[0],degree:1})},{name:"BL_PP_Degree",symbols:["BL_PP_Anchor","NumberLiteral"],postprocess:e=>({anchor:e[0],degree:e[1]})},{name:"BL_PP_Chord",symbols:[{literal:"c"}],postprocess:e=>({chord:!0,degree:1})},{name:"BL_PP_Chord",symbols:["BL_PP_Degree",{literal:"c"}],postprocess:e=>({chord:!0,anchor:e[0].anchor,degree:e[0].degree})},{name:"BL_PP_Chord",symbols:[{literal:"c"},"BL_PP_Roll"],postprocess:e=>({chord:!0,roll:e[1],degree:1})},{name:"BL_PP_Chord",symbols:["BL_PP_Degree",{literal:"c"},"BL_PP_Roll"],postprocess:e=>({chord:!0,roll:e[2],anchor:e[0].anchor,degree:e[0].degree})},{name:"BL_PP_Anchor",symbols:[{literal:"k"}],postprocess:e=>"KEY"},{name:"BL_PP_Anchor",symbols:[{literal:"n"}],postprocess:e=>"NEXT"},{name:"BL_PP_Anchor",symbols:[{literal:"s"}],postprocess:e=>"STEP"},{name:"BL_PP_Anchor",symbols:[{literal:"a"}],postprocess:e=>"ARPEGGIATE"},{name:"BL_PP_Roll",symbols:[{literal:"r"}],postprocess:e=>"ROLL_UP"},{name:"BL_PP_Roll",symbols:[{literal:"r"},{literal:"d"}],postprocess:e=>"ROLL_DOWN"},{name:"BL_OctavePart",symbols:["NumberLiteral"],postprocess:J},{name:"DrumBeatGroupLiteral",symbols:["StringLiteral","_?","BeatGroupLiteral"],postprocess:e=>new M(e[0],e[2])},{name:"DrumBeatGroupLiteral",symbols:["StringLiteral","_?","FunctionCallExpression"],postprocess:e=>new M(e[0],e[2])},{name:"DrumBeatLiteral",symbols:["NumberLiteral"],postprocess:e=>new j({time:e[0]})},{name:"DrumBeatLiteral",symbols:["NumberLiteral",{literal:"a"}],postprocess:e=>new j({time:e[0],accented:!0})},{name:"NumericExpression",symbols:["NE_addsub"],postprocess:J},{name:"NE_parens",symbols:[{literal:"("},"NE_addsub",{literal:")"}],postprocess:e=>e[1]},{name:"NE_parens",symbols:["NumberLiteral"],postprocess:J},{name:"NE_muldiv",symbols:["NE_muldiv",{literal:"*"},"NE_parens"],postprocess:e=>e[0]*e[2]},{name:"NE_muldiv",symbols:["NE_muldiv",{literal:"/"},"NE_parens"],postprocess:e=>e[0]/e[2]},{name:"NE_muldiv",symbols:["NE_parens"],postprocess:J},{name:"NE_addsub",symbols:["NE_addsub",{literal:"+"},"NE_muldiv"],postprocess:e=>e[0]+e[2]},{name:"NE_addsub",symbols:["NE_addsub",{literal:"-"},"NE_muldiv"],postprocess:e=>e[0]-e[2]},{name:"NE_addsub",symbols:["NE_muldiv"],postprocess:J},{name:"Identifier",symbols:[a.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>e[0].value},{name:"NumberLiteral",symbols:[a.has("number")?{type:"number"}:number],postprocess:e=>Number(e[0].value)},{name:"NumberLiteral",symbols:[a.has("beat_number")?{type:"beat_number"}:beat_number],postprocess:e=>Number(e[0].value)},{name:"BooleanLiteral",symbols:[a.has("boolean")?{type:"boolean"}:boolean],postprocess:e=>Boolean(e[0].value)},{name:"StringLiteral",symbols:[a.has("quoted_string")?{type:"quoted_string"}:quoted_string],postprocess:e=>e[0].value.slice(1,-1)},{name:"_?$ebnf$1",symbols:["_"],postprocess:J},{name:"_?$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_?",symbols:["_?$ebnf$1"],postprocess:()=>null},{name:"_",symbols:[a.has("ws")?{type:"ws"}:ws],postprocess:()=>null},{name:"_",symbols:[a.has("beat_ws")?{type:"beat_ws"}:beat_ws],postprocess:()=>null},{name:"_$ebnf$1",symbols:[a.has("ws")?{type:"ws"}:ws],postprocess:J},{name:"_$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$2$subexpression$1$ebnf$1",symbols:[a.has("ws")?{type:"ws"}:ws],postprocess:J},{name:"_$ebnf$2$subexpression$1$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$2$subexpression$1",symbols:[a.has("comment")?{type:"comment"}:comment,"_$ebnf$2$subexpression$1$ebnf$1"]},{name:"_$ebnf$2",symbols:["_$ebnf$2$subexpression$1"]},{name:"_$ebnf$2$subexpression$2$ebnf$1",symbols:[a.has("ws")?{type:"ws"}:ws],postprocess:J},{name:"_$ebnf$2$subexpression$2$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$2$subexpression$2",symbols:[a.has("comment")?{type:"comment"}:comment,"_$ebnf$2$subexpression$2$ebnf$1"]},{name:"_$ebnf$2",symbols:["_$ebnf$2","_$ebnf$2$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"_",symbols:["_$ebnf$1","_$ebnf$2"],postprocess:()=>null},{name:"_$ebnf$3",symbols:[a.has("beat_ws")?{type:"beat_ws"}:beat_ws],postprocess:J},{name:"_$ebnf$3",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$4$subexpression$1$ebnf$1",symbols:[a.has("beat_ws")?{type:"beat_ws"}:beat_ws],postprocess:J},{name:"_$ebnf$4$subexpression$1$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$4$subexpression$1",symbols:[a.has("comment")?{type:"comment"}:comment,"_$ebnf$4$subexpression$1$ebnf$1"]},{name:"_$ebnf$4",symbols:["_$ebnf$4$subexpression$1"]},{name:"_$ebnf$4$subexpression$2$ebnf$1",symbols:[a.has("beat_ws")?{type:"beat_ws"}:beat_ws],postprocess:J},{name:"_$ebnf$4$subexpression$2$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$4$subexpression$2",symbols:[a.has("comment")?{type:"comment"}:comment,"_$ebnf$4$subexpression$2$ebnf$1"]},{name:"_$ebnf$4",symbols:["_$ebnf$4","_$ebnf$4$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"_",symbols:["_$ebnf$3","_$ebnf$4"],postprocess:()=>null}],ParserStart:"main"};let W=function(e){const t=new o.a.Parser(o.a.Grammar.fromCompiled(K));return new Promise(function(s,r){try{t.feed(e)}catch(e){e.message=e.message.replace(/\t/g," "),r(e)}s(t.results)})};var z={string_to_ast:W,parse:function(e){return new Promise(function(t,s){W(e).then(e=>{if(!e.length)throw new SyntaxError("Something went wrong, input not parseable.");t(e[0])})})}};t.default={load:r.a.load,PlaybackStyle:class{constructor(e){this._mainPath=e,this._ASTs=new Map,this._initialized=!1}async _loadDependencies(){let e,t=[this._mainPath];for(;e=t.pop();){let s;try{s=await r.a.load(e)}catch(t){throw new Error(`Couldn't locate imported style "${e}".`)}let n=await z.parse(s);this._ASTs.set(e,n),n.init();for(let e of n.dependencies)this._ASTs.has(e)||t.push(e)}this._main=this._ASTs.get(this._mainPath)}_link(){this._main.link(this._ASTs)}async init(){await this._loadDependencies(),this._link(),this._initialized=!0}compile(e){if(!this._initialized)throw new Error("PlayBack style must be initialized before compiling");let t=e[Symbol.iterator](),s=t.next();console.log("nextValue",s);let r=this._main.execute(t);console.log("---final result---"),console.log(r)}async play(e){this.compile(e)}},parse:z.parse}},function(e,t){e.exports=require("path")}]);