!function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";(function(e){var r=n(5),s=n.n(r);const o=n(7);t.a={load:function(t){return new Promise(function(n,r){t.startsWith(".")||t.startsWith("/")||(t=o.join(e,"../../styles/",t+".play")),s.a.readFile(t,"utf8",(e,t)=>{e?r(e):n(t)})})}}}).call(this,"src/loader")},function(e,t){var n,r;n=this,r=function(){function e(t,n,r){return this.id=++e.highestId,this.name=t,this.symbols=n,this.postprocess=r,this}function t(e,t,n,r){this.rule=e,this.dot=t,this.reference=n,this.data=[],this.wantedBy=r,this.isComplete=this.dot===e.symbols.length}function n(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function r(e,t){this.rules=e,this.start=t||this.rules[0].name;var n=this.byName={};this.rules.forEach(function(e){n.hasOwnProperty(e.name)||(n[e.name]=[]),n[e.name].push(e)})}function s(){this.reset("")}function o(e,t,o){if(e instanceof r){var i=e;o=t}else i=r.fromCompiled(e,t);for(var a in this.grammar=i,this.options={keepHistory:!1,lexer:i.lexer||new s},o||{})this.options[a]=o[a];this.lexer=this.options.lexer,this.lexerState=void 0;var l=new n(i,0);this.table=[l];l.wants[i.start]=[],l.predict(i.start),l.process(),this.current=0}return e.highestId=0,e.prototype.toString=function(e){function t(e){return e.literal?JSON.stringify(e.literal):e.type?"%"+e.type:e.toString()}var n=void 0===e?this.symbols.map(t).join(" "):this.symbols.slice(0,e).map(t).join(" ")+" ● "+this.symbols.slice(e).map(t).join(" ");return this.name+" → "+n},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var n=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return n.left=this,n.right=e,n.isComplete&&(n.data=n.build()),n},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,o.fail))},n.prototype.process=function(e){for(var t=this.states,n=this.wants,r=this.completed,s=0;s<t.length;s++){var i=t[s];if(i.isComplete){if(i.finish(),i.data!==o.fail){for(var a=i.wantedBy,l=a.length;l--;){var c=a[l];this.complete(c,i)}if(i.reference===this.index){var m=i.rule.name;(this.completed[m]=this.completed[m]||[]).push(i)}}}else{if("string"!=typeof(m=i.rule.symbols[i.dot])){this.scannable.push(i);continue}if(n[m]){if(n[m].push(i),r.hasOwnProperty(m)){var u=r[m];for(l=0;l<u.length;l++){var p=u[l];this.complete(i,p)}}}else n[m]=[i],this.predict(m)}}},n.prototype.predict=function(e){for(var n=this.grammar.byName[e]||[],r=0;r<n.length;r++){var s=n[r],o=this.wants[e],i=new t(s,0,this.index,o);this.states.push(i)}},n.prototype.complete=function(e,t){var n=e.nextState(t);this.states.push(n)},r.fromCompiled=function(t,n){var s=t.Lexer;t.ParserStart&&(n=t.ParserStart,t=t.ParserRules);var o=new r(t=t.map(function(t){return new e(t.name,t.symbols,t.postprocess)}),n);return o.lexer=s,o},s.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},s.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},s.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},s.prototype.formatError=function(e,t){var n=this.buffer;if("string"==typeof n){var r=n.indexOf("\n",this.index);-1===r&&(r=n.length);var s=n.substring(this.lastLineBreak,r),o=this.index-this.lastLineBreak;return t+=" at line "+this.line+" col "+o+":\n\n",t+="  "+s+"\n",t+="  "+Array(o).join(" ")+"^"}return t+" at index "+(this.index-1)},o.fail={},o.prototype.feed=function(e){var t,r=this.lexer;for(r.reset(e,this.lexerState);t=r.next();){var o=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var i=this.current+1,a=new n(this.grammar,i);this.table.push(a);for(var l=t.value,c=r.constructor===s?t.value:t,m=o.scannable,u=m.length;u--;){var p=m[u],h=p.rule.symbols[p.dot];if(h.test?h.test(c):h.type?h.type===t.type:h.literal===l){var f=p.nextState({data:c,token:t,isToken:!0,reference:i-1});a.states.push(f)}}if(a.process(),0===a.states.length){var b=this.lexer.formatError(t,"invalid syntax")+"\n";b+="Unexpected "+(t.type?t.type+" token: ":""),b+=JSON.stringify(void 0!==t.value?t.value:t)+"\n";var P=new Error(b);throw P.offset=this.current,P.token=t,P}this.options.keepHistory&&(o.lexerState=r.save()),this.current++}return o&&(this.lexerState=r.save()),this.results=this.finish(),this},o.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},o.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},o.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},o.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach(function(n){n.rule.name===t&&n.dot===n.rule.symbols.length&&0===n.reference&&n.data!==o.fail&&e.push(n)}),e.map(function(e){return e.data})},{Parser:o,Grammar:r,Rule:e}},"object"==typeof e&&e.exports?e.exports=r():n.nearley=r()},function(e){e.exports={4:["1P 4P 7m 10m",["quartal"]],5:["1P 5P"],7:["1P 3M 5P 7m",["Dominant","Dom"]],9:["1P 3M 5P 7m 9M",["79"]],11:["1P 5P 7m 9M 11P"],13:["1P 3M 5P 7m 9M 13M",["13_"]],64:["5P 8P 10M"],M:["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],M13:["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],M6:["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],M69:["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],M7add13:["1P 3M 5P 6M 7M 9M"],M7b5:["1P 3M 5d 7M"],M7b6:["1P 3M 6m 7M"],M7b9:["1P 3M 5P 7M 9m"],M7sus4:["1P 4P 5P 7M"],M9:["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],M9b5:["1P 3M 5d 7M 9M"],M9sus4:["1P 4P 5P 7M 9M"],Madd9:["1P 3M 5P 9M",["2","add9","add2"]],Maj7:["1P 3M 5P 7M",["maj7","M7"]],Mb5:["1P 3M 5d"],Mb6:["1P 3M 13m"],Msus2:["1P 2M 5P",["add9no3","sus2"]],Msus4:["1P 4P 5P",["sus","sus4"]],Maddb9:["1P 3M 5P 9m"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],m:["1P 3m 5P"],"m#5":["1P 3m 5A",["m+","mb6"]],m11:["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],m11b5:["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],m13:["1P 3m 5P 7m 9M 11P 13M",["_13"]],m6:["1P 3m 4P 5P 13M",["_6"]],m69:["1P 3m 5P 6M 9M",["_69"]],m7:["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],m7add11:["1P 3m 5P 7m 11P",["m7add4"]],m7b5:["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],m9:["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],m9b5:["1P 3m 7m 12d 2M",["h9","-9b5"]],mMaj7:["1P 3m 5P 7M",["mM7","_M7"]],mMaj7b6:["1P 3m 5P 6m 7M",["mM7b6"]],mM9:["1P 3m 5P 7M 9M",["mMaj9","-M9"]],mM9b6:["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],mb6M7:["1P 3m 6m 7M"],mb6b9:["1P 3m 6m 9m"],o:["1P 3m 5d",["mb5","dim"]],o7:["1P 3m 5d 13M",["diminished","m6b5","dim7"]],o7M7:["1P 3m 5d 6M 7M"],oM7:["1P 3m 5d 7M"],sus24:["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],madd4:["1P 3m 4P 5P"],madd9:["1P 3m 5P 9M"]}},function(e){e.exports={chromatic:["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],lydian:["1P 2M 3M 4A 5P 6M 7M"],major:["1P 2M 3M 4P 5P 6M 7M",["ionian"]],mixolydian:["1P 2M 3M 4P 5P 6M 7m",["dominant"]],dorian:["1P 2M 3m 4P 5P 6M 7m"],aeolian:["1P 2M 3m 4P 5P 6m 7m",["minor"]],phrygian:["1P 2m 3m 4P 5P 6m 7m"],locrian:["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],altered:["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],iwato:["1P 2m 4P 5d 7m"],hirajoshi:["1P 2M 3m 5P 6m"],kumoijoshi:["1P 2m 4P 5P 6m"],pelog:["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],prometheus:["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],ritusen:["1P 2M 4P 5P 6M"],scriabin:["1P 2m 3M 5P 6M"],piongio:["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],augmented:["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],neopolitan:["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],diminished:["1P 2M 3m 4P 5d 6m 6M 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],egyptian:["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],oriental:["1P 2m 3M 4P 5d 6M 7m"],spanish:["1P 2m 3M 4P 5P 6m 7m",["phrygian major"]],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],flamenco:["1P 2m 3m 3M 4A 5P 7m"],balinese:["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],persian:["1P 2m 3M 4P 5d 6m 7M"],bebop:["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],enigmatic:["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],ichikosucho:["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty,assign="function"==typeof Object.assign?Object.assign:function(e,t){if(null==e)throw new TypeError("Target cannot be null or undefined");e=Object(e);for(var n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var s in r)hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},hasSticky="boolean"==typeof(new RegExp).sticky;function isRegExp(e){return e&&e.constructor===RegExp}function isObject(e){return e&&"object"==typeof e&&e.constructor!==RegExp&&!Array.isArray(e)}function reEscape(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function reGroups(e){var t=new RegExp("|"+e);return t.exec("").length-1}function reCapture(e){return"("+e+")"}function reUnion(e){var t=e.map(function(e){return"(?:"+e+")"}).join("|");return"(?:"+t+")"}function regexpOrLiteral(e){if("string"==typeof e)return"(?:"+reEscape(e)+")";if(isRegExp(e)){if(e.ignoreCase)throw new Error("RegExp /i flag not allowed");if(e.global)throw new Error("RegExp /g flag is implied");if(e.sticky)throw new Error("RegExp /y flag is implied");if(e.multiline)throw new Error("RegExp /m flag is implied");return e.source}throw new Error("not a pattern: "+e)}function objectToRules(e){for(var t=Object.getOwnPropertyNames(e),n=[],r=0;r<t.length;r++){var s=t[r],o=e[s],i=Array.isArray(o)?o:[o],a=[];i.forEach(function(e){isObject(e)?(a.length&&n.push(ruleOptions(s,a)),n.push(ruleOptions(s,e)),a=[]):a.push(e)}),a.length&&n.push(ruleOptions(s,a))}return n}function arrayToRules(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(!r.name)throw new Error("Rule has no name: "+JSON.stringify(r));t.push(ruleOptions(r.name,r))}return t}function ruleOptions(e,t){("object"!=typeof t||Array.isArray(t)||isRegExp(t))&&(t={match:t});var n=assign({tokenType:e,lineBreaks:!!t.error,pop:!1,next:null,push:null,error:!1,value:null,getType:null},t),r=n.match;return n.match=Array.isArray(r)?r:r?[r]:[],n.match.sort(function(e,t){return isRegExp(e)&&isRegExp(t)?0:isRegExp(t)?-1:isRegExp(e)?1:t.length-e.length}),n.keywords&&(n.getType=keywordTransform(n.keywords)),n}function compileRules(e,t){e=Array.isArray(e)?arrayToRules(e):objectToRules(e);for(var n=null,r=[],s=[],o=0;o<e.length;o++){var i=e[o];if(i.error){if(n)throw new Error("Multiple error rules not allowed: (for token '"+i.tokenType+"')");n=i}if(0!==i.match.length){r.push(i);var a=reUnion(i.match.map(regexpOrLiteral)),l=new RegExp(a);if(l.test(""))throw new Error("RegExp matches empty string: "+l);var c=reGroups(a);if(c>0)throw new Error("RegExp has capture groups: "+l+"\nUse (?: … ) instead");if(!t&&(i.pop||i.push||i.next))throw new Error("State-switching options are not allowed in stateless lexers (for token '"+i.tokenType+"')");if(!i.lineBreaks&&l.test("\n"))throw new Error("Rule should declare lineBreaks: "+l);s.push(reCapture(a))}}var m=hasSticky?"":"|(?:)",u=hasSticky?"ym":"gm",p=new RegExp(reUnion(s)+m,u);return{regexp:p,groups:r,error:n}}function compile(e){var t=compileRules(e);return new Lexer({start:t},"start")}function compileStates(e,t){var n=Object.getOwnPropertyNames(e);t||(t=n[0]);for(var r=Object.create(null),s=0;s<n.length;s++){var o=n[s];r[o]=compileRules(e[o],!0)}for(var s=0;s<n.length;s++)for(var i=r[n[s]].groups,a=0;a<i.length;a++){var l=i[a],c=l&&(l.push||l.next);if(c&&!r[c])throw new Error("Missing state '"+c+"' (in token '"+l.tokenType+"' of state '"+n[s]+"')");if(l&&l.pop&&1!=+l.pop)throw new Error("pop must be 1 (in token '"+l.tokenType+"' of state '"+n[s]+"')")}return new Lexer(r,t)}function keywordTransform(map){for(var reverseMap=Object.create(null),byLength=Object.create(null),types=Object.getOwnPropertyNames(map),i=0;i<types.length;i++){var tokenType=types[i],item=map[tokenType],keywordList=Array.isArray(item)?item:[item];keywordList.forEach(function(e){if((byLength[e.length]=byLength[e.length]||[]).push(e),"string"!=typeof e)throw new Error("keyword must be string (in keyword '"+tokenType+"')");reverseMap[e]=tokenType})}function str(e){return JSON.stringify(e)}var source="";for(var length in source+="(function(value) {\n",source+="switch (value.length) {\n",byLength){var keywords=byLength[length];source+="case "+length+":\n",source+="switch (value) {\n",keywords.forEach(function(e){var t=reverseMap[e];source+="case "+str(e)+": return "+str(t)+"\n"}),source+="}\n"}return source+="}\n",source+="})",eval(source)}var Lexer=function(e,t){this.startState=t,this.states=e,this.buffer="",this.stack=[],this.reset()};function tokenToString(){return this.value}if(Lexer.prototype.reset=function(e,t){return this.buffer=e||"",this.index=0,this.line=t?t.line:1,this.col=t?t.col:1,this.setState(t?t.state:this.startState),this},Lexer.prototype.save=function(){return{line:this.line,col:this.col,state:this.state}},Lexer.prototype.setState=function(e){if(e&&this.state!==e){this.state=e;var t=this.states[e];this.groups=t.groups,this.error=t.error||{lineBreaks:!0,shouldThrow:!0},this.re=t.regexp}},Lexer.prototype.popState=function(){this.setState(this.stack.pop())},Lexer.prototype.pushState=function(e){this.stack.push(this.state),this.setState(e)},Lexer.prototype._eat=hasSticky?function(e){return e.exec(this.buffer)}:function(e){var t=e.exec(this.buffer);return 0===t[0].length?null:t},Lexer.prototype._getGroup=function(e){if(null===e)return-1;for(var t=this.groups.length,n=0;n<t;n++)if(void 0!==e[n+1])return n;throw new Error("oops")},Lexer.prototype.next=function(){var e=this.re,t=this.buffer,n=e.lastIndex=this.index;if(n!==t.length){var r,s,o=this._eat(e),i=this._getGroup(o);-1===i?(r=this.error,s=t.slice(n)):(s=o[0],r=this.groups[i]);var a=0;if(r.lineBreaks){var l=/\n/g,c=1;if("\n"===s)a=1;else for(;l.exec(s);)a++,c=l.lastIndex}var m={type:r.getType&&r.getType(s)||r.tokenType,value:r.value?r.value(s):s,text:s,toString:tokenToString,offset:n,lineBreaks:a,line:this.line,col:this.col},u=s.length;if(this.index+=u,this.line+=a,0!==a?this.col=u-c+1:this.col+=u,r.shouldThrow)throw new Error(this.formatError(m,"invalid syntax"));return r.pop?this.popState():r.push?this.pushState(r.push):r.next&&this.setState(r.next),m}},"undefined"!=typeof Symbol&&Symbol.iterator){var LexerIterator=function(e){this.lexer=e};LexerIterator.prototype.next=function(){var e=this.lexer.next();return{value:e,done:!e}},LexerIterator.prototype[Symbol.iterator]=function(){return this},Lexer.prototype[Symbol.iterator]=function(){return new LexerIterator(this)}}return Lexer.prototype.formatError=function(e,t){var n=e.value,r=e.offset,s=e.lineBreaks?n.indexOf("\n"):n.length,o=Math.max(0,r-e.col+1),i=this.buffer.substring(o,r+s);return t+=" at line "+e.line+" col "+e.col+":\n\n",t+="  "+i+"\n",t+="  "+Array(e.col).join(" ")+"^"},Lexer.prototype.clone=function(){return new Lexer(this.states,this.state)},Lexer.prototype.has=function(e){for(var t in this.states)for(var n=this.states[t].groups,r=0;r<n.length;r++){var s=n[r];if(s.tokenType===e)return!0;if(s.keywords&&hasOwnProperty.call(s.keywords,e))return!0}return!1},{compile:compile,states:compileStates,error:Object.freeze({error:!0})}})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"names",function(){return f}),n.d(r,"tokenize",function(){return M}),n.d(r,"props",function(){return g}),n.d(r,"name",function(){return _}),n.d(r,"pc",function(){return x}),n.d(r,"midi",function(){return v}),n.d(r,"midiToFreq",function(){return w}),n.d(r,"freq",function(){return E}),n.d(r,"freqToMidi",function(){return L}),n.d(r,"chroma",function(){return S}),n.d(r,"oct",function(){return C}),n.d(r,"stepToLetter",function(){return T}),n.d(r,"altToAcc",function(){return j}),n.d(r,"from",function(){return N}),n.d(r,"build",function(){return O}),n.d(r,"fromMidi",function(){return F}),n.d(r,"simplify",function(){return G}),n.d(r,"enharmonic",function(){return R});var s={};n.r(s),n.d(s,"props",function(){return ge}),n.d(s,"names",function(){return _e}),n.d(s,"intervals",function(){return xe}),n.d(s,"notes",function(){return ve}),n.d(s,"exists",function(){return we}),n.d(s,"tokenize",function(){return Ee}),n.d(s,"modeNames",function(){return Ae}),n.d(s,"chords",function(){return ke}),n.d(s,"toScale",function(){return Le}),n.d(s,"supersets",function(){return Se}),n.d(s,"subsets",function(){return Ce});var o={};n.r(o),n.d(o,"names",function(){return Te}),n.d(o,"props",function(){return je}),n.d(o,"intervals",function(){return Ne}),n.d(o,"notes",function(){return Oe}),n.d(o,"exists",function(){return Fe}),n.d(o,"supersets",function(){return Ge}),n.d(o,"subsets",function(){return Re}),n.d(o,"tokenize",function(){return Ie});var i=n(0),a=n(1),l=n.n(a),c=n(4),m=n.n(c).a.states({main:{comment:{match:/\/\/.*?(?:\n|$)/,lineBreaks:!0},quoted_string:/"(?:[^\\"\n]|\\.)*"/,ws:{match:/\s+/,lineBreaks:!0},at_rule:["@meta","@options","@import","@track","@pattern"],identifier:{match:/[a-zA-z](?:[a-zA-Z\-\d]*[a-zA-Z\d])?/,keywords:{keyword:["if","as"],boolean:["true","false"]}},number:/(?:\d*\.)?\d+/,brackets:["{","}","(",")"],left_angle:{match:"<",push:"beat"},operators:["&","+","-","*","/","."]},beat:{beat_ws:/ +/,beat_colon:":",beat_number:/(?:\d*\.)?\d+/,beat_flag:/[a-zA-Z]/,beat_right_angle:{match:">",pop:!0},beat_operators:["|","+","-","*","/"]}});let u=Symbol("Nil"),p=function(e){return e!==u&&!1!==e};var h="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),f=function(e){return"string"!=typeof e?h.slice():h.filter(function(t){var n=t[1]||" ";return-1!==e.indexOf(n)})},b=f(" #"),P=f(" b"),d=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function M(e){"string"!=typeof e&&(e="");var t=d.exec(e);return t?[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]:null}var $=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),y=[0,2,4,5,7,9,11],g=function(e,t){return void 0===t&&(t={}),function(n){return t[n]||(t[n]=e(n))}}(function(e){var t=M(e);if(""===t[0]||""!==t[3])return $;var n=t[0],r=t[1],s=t[2],o={letter:n,acc:r,octStr:s};return o.pc=o.letter+o.acc,o.name=o.pc+s,o.step=(o.letter.charCodeAt(0)+3)%7,o.alt="b"===o.acc[0]?-o.acc.length:o.acc.length,o.oct=s.length?+s:null,o.chroma=(y[o.step]+o.alt+120)%12,o.midi=null!==o.oct?y[o.step]+o.alt+12*(o.oct+1):null,o.freq=w(o.midi),Object.freeze(o)}),_=function(e){return g(e).name},x=function(e){return g(e).pc},v=function(e){return g(e).midi||+e||null},w=function(e,t){return void 0===t&&(t=440),"number"==typeof e?Math.pow(2,(e-69)/12)*t:null},E=function(e){return g(e).freq||w(e)},A=Math.log(2),k=Math.log(440),L=function(e){var t=12*(Math.log(e)-k)/A+69;return Math.round(100*t)/100},S=function(e){return g(e).chroma},C=function(e){return g(e).oct},T=function(e){return"CDEFGAB"[e]},B=function(e,t){return Array(t+1).join(e)},j=function(e){return"number"!=typeof(t=e)?"":function(e){return e<0?B("b",-e):B("#",e)}(t);var t},N=function(e,t){void 0===e&&(e={}),void 0===t&&(t=null);var n=t?Object.assign({},g(t),e):e,r=n.step,s=n.alt,o=n.oct,i=T(r);if(!i)return null;var a=i+j(s);return o||0===o?a+o:a},O=N;function F(e,t){return e=Math.round(e),(!0===t?b:P)[e%12]+(Math.floor(e/12)-1)}var G=function(e,t){var n=g(e),r=n.alt,s=n.chroma,o=n.midi;if(null===s)return null;var i=!1===t?r<0:r>0;return null===o?x(F(s,i)):F(o,i)},R=function(e){return G(e,!1)};function D(e,t){var n=t.length,r=(e%n+n)%n;return t.slice(r,n).concat(t.slice(0,r))}var I=function(e){return e.filter(function(e){return 0===e||e})},J=function(e){var t=v(e);return null!==t?t:v(e+"-100")};function z(e){return(t=e,I(t.map(_)).sort(function(e,t){return J(e)>J(t)})).filter(function(e,t,n){return 0===t||e!==n[t-1]});var t}var q=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),W=[0,2,4,5,7,9,11],K=("1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null})),U=function(e){return(Math.abs(e)-1)%7},Y=function(e){var t=function(e){var t=q.exec(e);return null===t?null:t[1]?[t[1],t[2]]:[t[4],t[3]]}(e);if(null===t)return K;var n,r,s={num:+t[0],q:t[1]};return s.step=U(s.num),s.type="PMMPPMM"[s.step],"M"===s.type&&"P"===s.q?K:(s.name=""+s.num+s.q,s.dir=s.num<0?-1:1,s.simple=8===s.num||-8===s.num?s.num:s.dir*(s.step+1),s.alt=(n=s.type,"M"===(r=s.q)&&"M"===n?0:"P"===r&&"P"===n?0:"m"===r&&"M"===n?-1:/^A+$/.test(r)?r.length:/^d+$/.test(r)?"P"===n?-r.length:-r.length-1:null),s.oct=Math.floor((Math.abs(s.num)-1)/7),s.semitones=s.dir*(W[s.step]+s.alt+12*s.oct),s.chroma=(s.dir*(W[s.step]+s.alt)%12+12)%12,Object.freeze(s))},H={};function V(e){return"string"!=typeof e?K:H[e]||(H[e]=Y(e))}"P m M m M P d P m M m M".split(" ");var Z=[0,2,4,-1,1,3,5],X=Z.map(function(e){return Math.floor(7*e/12)}),Q=[3,0,4,1,5,2,6];var ee=function(e,t,n){var r=Q[function(e){var t=(e+1)%7;return t<0?7+t:t}(e)],s=Math.floor((e+1)/7);return void 0===t?{step:r,alt:s,dir:n}:{step:r,alt:s,oct:t+4*s+X[r],dir:n}},te=function(e){return t=function(t){var n=e(t);return null===n.name?null:function(e){var t=e.step,n=e.alt,r=e.oct,s=e.dir;void 0===s&&(s=1);var o=Z[t]+7*n;return null===r?[s*o]:[s*o,s*(r-X[t]-4*n)]}(n)},void 0===n&&(n={}),function(e){return n[e]||(n[e]=t(e))};var t,n},ne=te(g),re=te(V);function se(e,t){if(1===arguments.length)return function(t){return se(e,t)};var n=ne(e),r=re(t);if(null===n||null===r)return null;var s=1===n.length?[n[0]+r[0]]:[n[0]+r[0],n[1]+r[1]];return O(ee(s[0],s[1]))}var oe=n(3),ie=n(2),ae=function(e){return S(e)||function(e){return V(e).chroma}(e)||0},le=function(e){return parseInt(ce(e),2)};function ce(e){if(ue(e))return e;if(!Array.isArray(e))return"";var t=[0,0,0,0,0,0,0,0,0,0,0,0];return e.map(ae).forEach(function(e){t[e]=1}),t.join("")}var me=/^[01]{12}$/;function ue(e){return me.test(e)}"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");function pe(e,t){return arguments.length>1?pe(e)(t):(e=le(e),function(t){return(t=le(t))!==e&&(t&e)===t})}function he(e,t){return arguments.length>1?he(e)(t):(e=le(e),function(t){return(t=le(t))!==e&&(t|e)===t})}var fe,be,Pe,de=function(e){var t=Object.keys(e).sort(),n=[],r=[],s=function(e,t,s){n[e]=t,r[s]=r[s]||[],r[s].push(e)};t.forEach(function(t){var n=e[t][0].split(" "),r=e[t][1],o=ce(n);s(t,n,o),r&&r.forEach(function(e){return s(e,n,o)})});var o=Object.keys(n).sort(),i=function(e){return n[e]};return i.names=function(e){return"string"==typeof e?(r[e]||[]).slice():(!0===e?o:t).slice()},i},Me=de(oe),$e=de(ie),ye=(fe=Me,be=$e,(Pe=function(e){return fe(e)||be(e)}).names=function(e){return fe.names(e).concat(be.names(e))},Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null})),ge=function(e,t){return function(n){return t[n]||(t[n]=e(n))}}(function(e){var t=Me(e);if(!t)return ye;var n={intervals:t,name:e};return n.chroma=ce(t),n.setnum=parseInt(n.chroma,2),n.names=Me.names(n.chroma),Object.freeze(n)},{}),_e=Me.names,xe=function(e){var t=Ee(e);return ge(t[1]).intervals};function ve(e,t){var n=Ee(e);return t=t||n[1],xe(t).map(se(n[0]))}function we(e){var t=Ee(e);return void 0!==Me(t[1])}function Ee(e){if("string"!=typeof e)return["",""];var t=e.indexOf(" "),n=_(e.substring(0,t))||_(e)||"",r=""!==n?e.substring(n.length+1):e;return[n,r.length?r:""]}var Ae=function(e){var t=xe(e),n=ve(e);return function(e,t){t=!1!==t;var n=ce(e).split("");return I(n.map(function(e,r){var s=D(r,n);return t&&"0"===s[0]?null:s.join("")}))}(t).map(function(e,r){var s=Me.names(e)[0];if(s)return[n[r]||t[r],s]}).filter(function(e){return e})},ke=function(e){var t=pe(xe(e));return $e.names().filter(function(e){return t($e(e))})},Le=function(e){var t=I(e.map(x));if(!t.length)return t;var n=t[0],r=z(t);return D(r.indexOf(n),r)},Se=function(e){if(!xe(e).length)return[];var t=he(xe(e));return Me.names().filter(function(e){return t(Me(e))})},Ce=function(e){var t=pe(xe(e));return Me.names().filter(function(e){return t(Me(e))})},Te=$e.names,Be=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),je=function(e,t){return void 0===t&&(t={}),function(n){return t[n]||(t[n]=e(n))}}(function(e){var t=$e(e);if(!t)return Be;var n={intervals:t,name:e};return n.chroma=ce(t),n.setnum=parseInt(n.chroma,2),n.names=$e.names(n.chroma),n}),Ne=function(e){return je(Ie(e)[1]).intervals};function Oe(e,t){var n=Ie(e);return t=t||n[1],je(t).intervals.map(se(n[0]))}var Fe=function(e){return void 0!==$e(Ie(e)[1])},Ge=function(e){if(!Ne(e).length)return[];var t=he(Ne(e));return $e.names().filter(function(e){return t($e(e))})},Re=function(e){var t=pe(Ne(e));return $e.names().filter(function(e){return t($e(e))})},De=/^(6|64|7|9|11|13)$/;function Ie(e){var t=M(e);return""===t[0]?["",e]:"A"===t[0]&&"ug"===t[3]?["","aug"]:De.test(t[2])?[t[0]+t[1],t[2]+t[3]]:[t[0]+t[1]+t[2],t[3]]}let Je=Symbol("AwaitingDrum");class ze{constructor(e){this.time=e.time,this.pitch=e.pitch,this.duration=e.duration,this.volume=e.volume}get midi(){return this.pitch===Je?null:r.midi(this.pitch)}get velocity(){return Math.floor(127*this.volume)}}class qe extends Array{constructor(){super(),this.push(...arguments)}}class We extends Error{constructor(e,t){super(`${e}\nScope: "${t.name}"`)}}class Ke extends We{constructor(){super(...arguments)}}class Ue extends Ke{constructor(e,t){super(`No style with the name "${e}" was imported`,t)}}class Ye extends Ke{constructor(e,t,n){super(`No track with the name "${t}" exists in the style "${e}"`,n)}}class He extends We{constructor(e,t){super(`No function exists with name "${e}"`,t)}}class Ve extends We{constructor(e,t){super(e,t)}}class Ze extends We{constructor(e,t){super(e,t)}}class Xe extends We{constructor(e){super('Pattern may only contain 1 BeatGroup. Try the join operator "&"',e)}}class Qe extends We{constructor(e){super("Unexpected Melodic Beat in a Drum Beat Group",e)}}class et extends We{constructor(e){super("Unexpected Drum Beat in a Melodic Beat Group",e)}}class tt{constructor(){this.vars=new Map,this.name=null,this.type=null,this.scope=null}init(e){this.scope=e,this.vars=new Map([...this.scope.vars,...this.vars])}}class nt extends tt{constructor(e){super(),this.name="@meta",this.type="@meta",this.function_calls=e}init(e){this.scope=e;for(let e of this.function_calls)e.init(this),e.execute();e.meta=this.vars}}class rt extends tt{constructor(e){super(),this.name="@options",this.type="@options",this.function_calls=e}init(e){for(let e of this.function_calls)e.init(this),e.execute();this.scope=e,e.vars=new Map([...e.vars,...this.vars])}}class st{constructor(e,t){this.path=e,this.identifier=t}}let ot=new Map;function it(e,t,n,r){if("*"!=n){if(t.length!=n.length)throw new Ze(`"${e}" requires ${n.length} arguments.`,r);for(let s in t){if("*"==n[s])continue;let o=t[s];if(o instanceof mt){if("*"==(o=o.returns))continue;if("string"==typeof n[s]){if(o!=n[s])throw new Ze(`Argument ${Number(s)+1} of "${e}" must be a ${n[s]}.`,r)}else if(o!=n[s])throw new Ze(`Argument ${Number(s)+1} of "${e}" must be a ${n[s].name}.`,r)}else if("string"==typeof n[s]){if(typeof o!=n[s])throw new Ze(`Argument ${Number(s)+1} of "${e}" must be a ${n[s]}.`,r)}else if(!(o instanceof n[s]))throw new Ze(`Argument ${Number(s)+1} of "${e}" must be a ${n[s].name}.`,r)}}}let at=function(e,t,n){let r={types:t.types||"*",returns:t.returns||"*",scope:t.scope||"no-meta",execute:(e,t)=>{return n(e,t,e=>{throw new Ze(e,t)})}};ot.set(e,r)},lt=function(e,t,n=null){at(e,{types:[t],scope:n,returns:u},(t,n,r)=>(n.vars.set(e,t[0]),u))},ct=function(e,t=null){at(e,{types:"*",scopes:t,returns:u},(t,n,r)=>(t.length?(it(e,t,["boolean"],n),n.vars.set(e,t[0])):n.vars.set(e,!0),u))};lt("name","string","meta"),lt("author","string","meta"),lt("description","string","meta"),lt("playback-version","number","meta"),at("time-signature",{types:["number","number"],scope:"options",returns:u},(e,t,n)=>(Number.isInteger(Math.log2(e[1]))||n('Argument 2 of "time-signature" must be a power of 2.'),t.vars.set("time-signature",[e[0],e[1]]),u)),ct("swing","options"),at("volume",{types:["number"],scope:"no-meta",returns:u},(e,t,n)=>((e[0]<0||e[0]>1)&&n('Argument 1 of "volume" must be in range 0-1 (inclusive).'),t.vars.set("volume",e[0]),u)),ct("invertible","no-meta"),lt("octave","number","no-meta"),at("choose",{types:"*",scope:"no-config",returns:"*"},(e,t,n)=>{let r=e.filter(e=>e!==u);if(r.length){return r[Math.floor(Math.random()*r.length)]}return u}),at("progression",{types:"*",scope:"no-config",returns:"boolean"},(e,t,n)=>!0),at("in-scale",{types:"*",scope:"no-config",returns:"boolean"},(e,t,n)=>!1),ct("private","pattern"),lt("length","number","pattern"),at("chance",{types:["number"],scope:"pattern",returns:u},(e,t,n)=>((e[0]<0||e[0]>1)&&n('Argument 1 of "chance" must be in range 0-1 (inclusive).'),t.vars.set("chance",e[0]),u));class mt{constructor(e,t){this.identifier=e,this.definition=ot.get(e),this.args=t,this.scope=null}init(e){if(this.scope=e,!this.definition)throw new He(this.identifier,this.scope);this.returns=this.definition.returns,function(e,t="no-meta",n){if("meta"==t){if("@meta"!=n.type)throw new Ve(`Function "${e}" must only be called within a @meta block."`,n)}else if("options"==t){if("@options"!=n.type)throw new Ve(`Function "${e}" must only be called within an @options block."`,n)}else if("no-config"==t){if("@meta"==n.type||"@options"==n.type)throw new Ve(`Function "${e}" must not be called within a @meta or @options block."`,n)}else if("pattern"==t){if("PatternExpressionGroup"!=n.type)throw new Ve(`Function "${e}" must only be called within a @pattern block."`,n)}else if("no-meta"==t&&"@meta"==n.type)throw new Ve(`Function "${e}" must not be called within a @meta block."`,n)}(this.identifier,this.definition.scope,this.scope),this.args.forEach(t=>{t.init&&t.init(e)}),it(this.identifier,this.args,this.definition.types,this.scope)}link(e,t,n){this.args.forEach(r=>{r.link&&r.link(e,t,n)})}execute(e){if(!this.scope)throw new Error("function not initialized :(");let t=this.args.map(t=>t.execute?t.execute(e):t),n=this.definition.execute(t,this.scope);if(void 0===n)throw new Error(`Function "${this.identifier}" can return undefined`);return n}}class ut{constructor(e,t){this.drum=e,this.beatGroup=t}init(e){this.scope=e,this.beatGroup.init&&this.beatGroup.init(e)}link(){}execute(e){let t=this.beatGroup.execute(e);for(let e of t){if(e.pitch!==Je)throw new Qe(this.scope);e.pitch=this.drum}return t}}class pt extends tt{constructor(e){super(),this.type="PatternExpressionGroup",this.name="@pattern(<anonymous>)",this.vars.set("private",!1),this.vars.set("chance",1),this.expressions=e,this.function_calls=[],this.non_function_call_expressions=[]}init(e,t=null){super.init(e),this.patternStatement=t,this.patternStatement&&(this.name=`@pattern(${this.patternStatement})`),this.expressions.forEach(e=>{if(!e.init)throw["expression not initialized:",e];e.init(this),e instanceof mt?this.function_calls.push(e):this.non_function_call_expressions.push(e)})}link(e,t,n){this.expressions.forEach(r=>{r.link(e,t,n)})}execute(e,t=!1){let n=u;for(let t of this.function_calls){let r=t.execute(e);if(r instanceof qe){if(n!==u)throw new Xe(this);n=r}}if(t&&!0===this.vars.get("private"))return u;for(let t of this.non_function_call_expressions)if(t.execute&&(t=t.execute(e)),t instanceof qe){if(n!==u)throw new Xe(this);n=t}return n}}class ht extends pt{constructor(e){e.expression instanceof pt?super(e.expression.expressions):super([e.expression]),this.identifier=e.identifier,this.condition=void 0!==e.condition?e.condition:null}getChance(){return this.vars.get("chance")}link(e,t,n){super.link(e,t,n),this.condition&&this.condition.link&&this.condition.link(e,t,n)}init(e){super.init(e),this.condition&&this.condition.init&&this.condition.init(this)}execute(e,t){if(this.condition){let e=this.condition.execute();if(!1===p(e))return u}return super.execute(e,t)}}class ft{constructor(e){this.import=e.import||null,this.track=e.track||null,this.pattern=e.pattern,this.scope=null,this.patternStatement=null,this.prettyprintname=(this.import||"this")+"."+(this.track||"this")+"."+this.pattern}getChance(){return this.patternStatement.getChance()()}init(e){this.scope=e}link(e,t,n){let r,s;if(null===this.import)r=t;else{let n=t.importedStyles.get(this.import);if(!(r=e.get(n)))throw new NoSuchStyleError(this.import,this)}if(null===this.track)s=n;else if(!(s=r.tracks.get(this.track)))throw new NoSuchTrackError(this.import||"this",this.track||"this",this);let o=s.patterns.get(this.pattern);if(!o)throw new NoSuchPatternError(this.import||"this",this.track||"this",this.pattern,this);this.patternStatement=o}execute(e){return this.patternStatement.execute(e)}}class bt extends tt{constructor(e){super(),this.name=e.identifier,this.type="@track",this.instrument=e.instrument,this.identifier=e.identifier,this.members=e.members}init(e){super.init(e),this.function_calls=[],this.patterns=new Map,this.patternCalls=[],this.members.forEach(e=>{e.init(this),e instanceof mt?this.function_calls.push(e):e instanceof ht?this.patterns.set(e.identifier,e):e instanceof ft&&this.patternCalls.push(e)})}link(e,t){for(let n of this.patternCalls)n.link(e,t,this),this.patterns.set(n.prettyprintname,n);for(let[n,r]of this.patterns)r.link(e,t,this)}execute(e){console.log(`executing TrackStatement "${this.name}"`),this.function_calls.forEach(t=>{t.execute(e)});let t=0,n=[];for(let[r,s]of this.patterns){console.log(`- pattern "${r}":`);let o=s.execute(e,!0);if(console.log("  - Result:",o),o!==u){for(let e of o)if(e.pitch===Je)throw new et(s);let e=s.getChance();n.push({noteSet:o,lower:t,upper:t+e}),t+=e}}let r=Math.random()*t;for(let e of n)if(e.lower<=r&&r<=e.upper)return console.log("  - Final result:",e.noteSet),e.noteSet;return console.log("  - Final result:",u),u}}class Pt{constructor(e){this.import=e.import,this.track=e.track,this.trackStatement=null}execute(e){this.trackStatement.execute(e)}}class dt{constructor(){this.args=Array.prototype.slice.call(arguments)}link(e,t,n){this.args.forEach(r=>{r.link&&r.link(e,t,n)})}init(e){this.scope=e,this.args.forEach(t=>{t.init&&t.init(e)})}resolve_args(e){return this.args.map(t=>t.init?t.init(e):t)}}class Mt{constructor(e){this.time=e.time||{time:"auto"},this.pitch=e.pitch,this.octave=e.octave||"inherit",this.scope=null,this.parentMeasure=null,this.indexInMeasure=null}init(e,t,n){this.scope=e,this.parentMeasure=t,this.indexInMeasure=n}getTime(){return"auto"===this.time.time?this.indexInMeasure+1:this.time.time}normalizeChord(e){return e.replace(/-/g,"_").replace(/minor|min/g,"m")}chordToScaleName(e){let t=o.tokenize(e)[1],n=o.props(t).names;if(n.includes("dim"))return"diminished";if(n.includes("aug"))return"augmented";if(n.includes("Major"))return"major";if(n.includes("minor"))return"minor";if(n.includes("minor7"))return"dorian";if(n.includes("Dominant"))return"mixolydian";let r="major";return n.forEach(e=>{e.startsWith("dim")&&(r="diminished"),e.startsWith("aug")&&(r="augmented"),e.startsWith("M")&&(r="major"),e.startsWith("m")&&(r="minor")}),r}getPitches(e){let t,n;switch(this.pitch.anchor){case"KEY":t=e.song.getKey();break;case"NEXT":{let n=e.getRelative(1);t=n?n[0]:e.song.getKey();break}case"STEP":case"ARPEGGIATE":t=e.getRelative(0)[0];break;default:{let n=Math.floor(this.getTime());do{t=e.getRelative(0)[n],n--}while(!t)}}t=this.normalizeChord(t);let i=o.tokenize(t)[0],a=this.chordToScaleName(t),l=s.notes(i,a)[this.pitch.degree-1];if(n=r.from({oct:this.getOctave()},l),this.pitch.chord){let e=o.tokenize(t)[1];return o.notes(n,e)}return[n]}getOctave(){return"inherit"===this.octave?this.scope.vars.get("octave"):this.octave}getDuration(){let e;return e=this.parentMeasure.calculateDurationAfter(this.indexInMeasure),this.time.flag,e}getVolume(){let e=this.scope.vars.get("volume");return"ACCENTED"===this.time.flag&&(e=Math.min(1,e+=.1)),e}execute(e){let t=new qe,n=this.getTime(),r=this.getPitches(e),s=this.getDuration(),o=this.getVolume();for(let e of r)t.push(new ze({time:n,pitch:e,duration:s,volume:o}));return t}}class $t{constructor(e){this.time=e.time,this.accented=e.accented||!1,this.scope=null,this.parentMeasure=null,this.indexInMeasure=null}init(e,t,n){this.scope=e,this.parentMeasure=t,this.indexInMeasure=n}getTime(){return this.time}getDuration(){let e;return e=this.parentMeasure.calculateDurationAfter(this.indexInMeasure)}getVolume(){let e=this.scope.vars.get("volume");return this.accented&&(e=Math.min(1,e+=.1)),e}execute(e){let t=this.getTime(),n=this.getDuration(),r=this.getVolume();return new qe(new ze({time:t,pitch:Je,duration:n,volume:r}))}}function yt(e){return e[0]}var gt={Lexer:m,ParserRules:[{name:"main$macrocall$2",symbols:["TopLevelStatement"]},{name:"main$macrocall$1$ebnf$1",symbols:[]},{name:"main$macrocall$1$ebnf$1$subexpression$1",symbols:["_","main$macrocall$2"],postprocess:e=>e[1][0]},{name:"main$macrocall$1$ebnf$1",symbols:["main$macrocall$1$ebnf$1","main$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"main$macrocall$1",symbols:["main$macrocall$2","main$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"main",symbols:["_?","main$macrocall$1","_?"],postprocess:e=>new class extends tt{constructor(e){super(),this.name="global",this.type="global",this.statements=e}init(){this.vars.set("octave",2),this.vars.set("volume",1),this.vars.set("private",!1),this.vars.set("time-signature",[4,4]),this.vars.set("tempo",120),this.tracks=new Map,this.meta=[],this.importedStyles=new Map,this.trackCalls=[],this.dependencies=[];for(let e of this.statements)e instanceof nt||e instanceof rt?this.meta.push(e):e instanceof st?(this.importedStyles.set(e.identifier,e.path),this.dependencies.push(e.path)):e instanceof bt?this.tracks.set(e.name,e):e instanceof Pt&&this.trackCalls.push(e);this.meta.forEach(e=>e.init(this)),this.tracks.forEach(e=>e.init(this))}link(e){for(let t of this.trackCalls){let n=this.importedStyles.get(t.import),r=e.get(n);if(!r)throw new Ue(t.import,this);let s=r.tracks.get(t.track);if(!s)throw new Ye(t.import,t.track,this);this.tracks.set(`${t.import}.${t.track}`,s)}for(let[t,n]of this.tracks)n.link(e,this)}execute(e){let t=new qe;for(let[n,r]of this.tracks){let n=r.execute(e);n!==u&&t.push(...n)}return t}}(e[1])},{name:"TopLevelStatement",symbols:["ConfigurationStatement"],postprocess:yt},{name:"TopLevelStatement",symbols:["ImportStatement"],postprocess:yt},{name:"TopLevelStatement",symbols:["TrackStatement"],postprocess:yt},{name:"TopLevelStatement",symbols:["TrackCallStatement"],postprocess:yt},{name:"ConfigurationStatement",symbols:[{literal:"@meta"},"_?",{literal:"{"},"_?","ConfigurationList","_?",{literal:"}"}],postprocess:e=>new nt(e[4])},{name:"ConfigurationStatement",symbols:[{literal:"@options"},"_?",{literal:"{"},"_?","ConfigurationList","_?",{literal:"}"}],postprocess:e=>new rt(e[4])},{name:"ConfigurationList$macrocall$2",symbols:["FunctionCallExpression"]},{name:"ConfigurationList$macrocall$1$ebnf$1",symbols:[]},{name:"ConfigurationList$macrocall$1$ebnf$1$subexpression$1",symbols:["_","ConfigurationList$macrocall$2"],postprocess:e=>e[1][0]},{name:"ConfigurationList$macrocall$1$ebnf$1",symbols:["ConfigurationList$macrocall$1$ebnf$1","ConfigurationList$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ConfigurationList$macrocall$1",symbols:["ConfigurationList$macrocall$2","ConfigurationList$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"ConfigurationList",symbols:["ConfigurationList$macrocall$1"],postprocess:yt},{name:"ImportStatement",symbols:[{literal:"@import"},"_","StringLiteral","_",{literal:"as"},"_","Identifier"],postprocess:e=>new st(e[2],e[6])},{name:"TrackStatement$macrocall$2",symbols:["TrackMember"]},{name:"TrackStatement$macrocall$1$ebnf$1",symbols:[]},{name:"TrackStatement$macrocall$1$ebnf$1$subexpression$1",symbols:["_","TrackStatement$macrocall$2"],postprocess:e=>e[1][0]},{name:"TrackStatement$macrocall$1$ebnf$1",symbols:["TrackStatement$macrocall$1$ebnf$1","TrackStatement$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"TrackStatement$macrocall$1",symbols:["TrackStatement$macrocall$2","TrackStatement$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"TrackStatement",symbols:[{literal:"@track"},"_","StringLiteral","_",{literal:"as"},"_","Identifier","_?",{literal:"{"},"_?","TrackStatement$macrocall$1","_?",{literal:"}"}],postprocess:e=>new bt({instrument:e[2],identifier:e[6],members:e[10]})},{name:"TrackMember",symbols:["FunctionCallExpression"],postprocess:yt},{name:"TrackMember",symbols:["PatternStatement"],postprocess:yt},{name:"TrackMember",symbols:["PatternCallExpression"],postprocess:yt},{name:"TrackCallStatement",symbols:[{literal:"@track"},"_?",{literal:"("},"_?","Identifier",{literal:"."},"Identifier","_?",{literal:")"}],postprocess:e=>new Pt({import:e[4],track:e[6]})},{name:"PatternStatement",symbols:[{literal:"@pattern"},"_","Identifier","_","PatternConditional","_?","PatternExpression"],postprocess:e=>new ht({identifier:e[2],expression:e[6],condition:e[4]})},{name:"PatternStatement",symbols:[{literal:"@pattern"},"_","Identifier","_","PatternExpression"],postprocess:e=>new ht({identifier:e[2],expression:e[4]})},{name:"PatternConditional",symbols:[{literal:"if"},"_?",{literal:"("},"_?","FunctionCallArgument","_?",{literal:")"}],postprocess:e=>e[4]},{name:"PatternExpression",symbols:["PatternExpression_NoJoin"],postprocess:yt},{name:"PatternExpression",symbols:["JoinedPatternExpression"],postprocess:yt},{name:"PatternExpression_NoJoin",symbols:["PatternExpressionGroup"],postprocess:yt},{name:"PatternExpression_NoJoin",symbols:["BeatGroupLiteral"],postprocess:yt},{name:"PatternExpression_NoJoin",symbols:["DrumBeatGroupLiteral"],postprocess:yt},{name:"PatternExpression_NoJoin",symbols:["FunctionCallExpression"],postprocess:yt},{name:"PatternExpression_NoJoin",symbols:["PatternCallExpression"],postprocess:yt},{name:"PatternExpressionGroup$macrocall$2",symbols:["PatternExpression"]},{name:"PatternExpressionGroup$macrocall$1$ebnf$1",symbols:[]},{name:"PatternExpressionGroup$macrocall$1$ebnf$1$subexpression$1",symbols:["_","PatternExpressionGroup$macrocall$2"],postprocess:e=>e[1][0]},{name:"PatternExpressionGroup$macrocall$1$ebnf$1",symbols:["PatternExpressionGroup$macrocall$1$ebnf$1","PatternExpressionGroup$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"PatternExpressionGroup$macrocall$1",symbols:["PatternExpressionGroup$macrocall$2","PatternExpressionGroup$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"PatternExpressionGroup",symbols:[{literal:"{"},"_?","PatternExpressionGroup$macrocall$1","_?",{literal:"}"}],postprocess:e=>new pt(e[2])},{name:"PatternCallExpression",symbols:[{literal:"@pattern"},"_?",{literal:"("},"_?","Identifier","_?",{literal:")"}],postprocess:e=>new ft({pattern:e[4]})},{name:"PatternCallExpression",symbols:[{literal:"@pattern"},"_?",{literal:"("},"_?","Identifier",{literal:"."},"Identifier","_?",{literal:")"}],postprocess:e=>new ft({track:e[4],pattern:e[6]})},{name:"PatternCallExpression",symbols:[{literal:"@pattern"},"_?",{literal:"("},"_?","Identifier",{literal:"."},"Identifier",{literal:"."},"Identifier","_?",{literal:")"}],postprocess:e=>new ft({import:e[4],track:e[6],pattern:e[8]})},{name:"JoinedPatternExpression$macrocall$2",symbols:["PatternExpression_NoJoin"]},{name:"JoinedPatternExpression$macrocall$3",symbols:[{literal:"&"}]},{name:"JoinedPatternExpression$macrocall$1$ebnf$1$subexpression$1",symbols:["_?","JoinedPatternExpression$macrocall$3","_?","JoinedPatternExpression$macrocall$2"],postprocess:e=>e[3][0]},{name:"JoinedPatternExpression$macrocall$1$ebnf$1",symbols:["JoinedPatternExpression$macrocall$1$ebnf$1$subexpression$1"]},{name:"JoinedPatternExpression$macrocall$1$ebnf$1$subexpression$2",symbols:["_?","JoinedPatternExpression$macrocall$3","_?","JoinedPatternExpression$macrocall$2"],postprocess:e=>e[3][0]},{name:"JoinedPatternExpression$macrocall$1$ebnf$1",symbols:["JoinedPatternExpression$macrocall$1$ebnf$1","JoinedPatternExpression$macrocall$1$ebnf$1$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"JoinedPatternExpression$macrocall$1",symbols:["JoinedPatternExpression$macrocall$2","JoinedPatternExpression$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"JoinedPatternExpression",symbols:["JoinedPatternExpression$macrocall$1"],postprocess:e=>new class{constructor(e){this.patterns=e}init(e){this.scope=e,this.patterns.forEach(t=>{t.init&&t.init(e)})}link(e,t,n){this.patterns.forEach(r=>{r.link(e,t,n)})}execute(e){let t=[];for(let n of this.patterns)n.execute&&(n=n.execute(e)),n instanceof qe&&t.push(n);return t.length?(new qe).concat(...t):u}}(e[0])},{name:"FunctionCallExpression$macrocall$2",symbols:["FunctionCallArgument"]},{name:"FunctionCallExpression$macrocall$1$ebnf$1",symbols:[]},{name:"FunctionCallExpression$macrocall$1$ebnf$1$subexpression$1",symbols:["_","FunctionCallExpression$macrocall$2"],postprocess:e=>e[1][0]},{name:"FunctionCallExpression$macrocall$1$ebnf$1",symbols:["FunctionCallExpression$macrocall$1$ebnf$1","FunctionCallExpression$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"FunctionCallExpression$macrocall$1",symbols:["FunctionCallExpression$macrocall$2","FunctionCallExpression$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"FunctionCallExpression",symbols:["Identifier","_?",{literal:"("},"_?","FunctionCallExpression$macrocall$1","_?",{literal:")"}],postprocess:e=>new mt(e[0],e[4])},{name:"FunctionCallExpression",symbols:["Identifier","_?",{literal:"("},{literal:")"}],postprocess:e=>new mt(e[0],[])},{name:"FunctionCallArgument",symbols:["NumericExpression"],postprocess:yt},{name:"FunctionCallArgument",symbols:["StringLiteral"],postprocess:yt},{name:"FunctionCallArgument",symbols:["BooleanLiteral"],postprocess:yt},{name:"FunctionCallArgument",symbols:["PatternExpression"],postprocess:yt},{name:"FunctionCallArgument",symbols:["BL_PP_Anchor"],postprocess:e=>new class{constructor(e){this.anchor=e}}(e[0])},{name:"FunctionCallArgument",symbols:[{literal:"not"},"_","FunctionCallArgument"],postprocess:e=>new class extends dt{constructor(){super(arguments)}execute(e){let t=this.resolve_args(e);return!p(t[0])}}(e[2])},{name:"FunctionCallArgument",symbols:["FunctionCallArgument","_",{literal:"and"},"_","FunctionCallArgument"],postprocess:e=>new class extends dt{constructor(){super(arguments)}execute(e){let t=this.resolve_args(e);return p(t[0])&&p(t[1])}}(e[0],e[4])},{name:"FunctionCallArgument",symbols:["FunctionCallArgument","_",{literal:"or"},"_","FunctionCallArgument"],postprocess:e=>new class extends dt{constructor(){super(arguments)}execute(e){let t=this.resolve_args(e);return p(t[0])||p(t[1])}}(e[0],e[4])},{name:"BeatGroupLiteral",symbols:[{literal:"<"},"_?","MeasureGroup","_?",{literal:">"}],postprocess:e=>new class{constructor(e){this.measures=e,this.scope=null}init(e){this.scope=e,this.measures.forEach(t=>t.init(e))}link(){}execute(e){let t=new qe;for(let n=0;n<this.measures.length;n++){let r=4*n,s=this.measures[n].execute(e);if(s===u)return u;for(let e of s)e.time+=r,t.push(e)}return t}}(e[2])},{name:"MeasureGroup$macrocall$2",symbols:["Measure"]},{name:"MeasureGroup$macrocall$3",symbols:[{literal:"|"}]},{name:"MeasureGroup$macrocall$1$ebnf$1",symbols:[]},{name:"MeasureGroup$macrocall$1$ebnf$1$subexpression$1",symbols:["_?","MeasureGroup$macrocall$3","_?","MeasureGroup$macrocall$2"],postprocess:e=>e[3][0]},{name:"MeasureGroup$macrocall$1$ebnf$1",symbols:["MeasureGroup$macrocall$1$ebnf$1","MeasureGroup$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"MeasureGroup$macrocall$1",symbols:["MeasureGroup$macrocall$2","MeasureGroup$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"MeasureGroup",symbols:["MeasureGroup$macrocall$1"],postprocess:yt},{name:"Measure$macrocall$2",symbols:["MelodicBeatLiteral"]},{name:"Measure$macrocall$1$ebnf$1",symbols:[]},{name:"Measure$macrocall$1$ebnf$1$subexpression$1",symbols:["_","Measure$macrocall$2"],postprocess:e=>e[1][0]},{name:"Measure$macrocall$1$ebnf$1",symbols:["Measure$macrocall$1$ebnf$1","Measure$macrocall$1$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"Measure$macrocall$1",symbols:["Measure$macrocall$2","Measure$macrocall$1$ebnf$1"],postprocess:e=>e[0].concat(e[1])},{name:"Measure",symbols:["Measure$macrocall$1"],postprocess:e=>new class{constructor(e){this.beats=e,this.beatsPerMeasure=null,this.scope=null}calculateDurationAfter(e){let t,n=this.beats[e].getTime();return(t=e+1>=this.beats.length?this.beatsPerMeasure+1:this.beats[e+1].getTime())-n}init(e){this.scope=e,this.beatsPerMeasure=this.scope.vars.get("time-signature")[0],this.beats.forEach((t,n)=>{t.init(e,this,n)})}execute(e){let t=new qe;for(let n of this.beats){let r=n.execute(e);if(r===u)return u;t.push(...r)}return t}}(e[0])},{name:"MelodicBeatLiteral",symbols:["BL_TimePart",{literal:":"},"BL_PitchPart",{literal:":"},"BL_OctavePart"],postprocess:e=>new Mt({time:e[0],pitch:e[2],octave:e[4]})},{name:"MelodicBeatLiteral",symbols:[{literal:":"},"BL_PitchPart",{literal:":"},"BL_OctavePart"],postprocess:e=>new Mt({pitch:e[1],octave:e[3]})},{name:"MelodicBeatLiteral",symbols:["BL_TimePart",{literal:":"},"BL_PitchPart"],postprocess:e=>new Mt({time:e[0],pitch:e[2]})},{name:"MelodicBeatLiteral",symbols:[{literal:":"},"BL_PitchPart"],postprocess:e=>new Mt({pitch:e[1]})},{name:"MelodicBeatLiteral",symbols:["DrumBeatLiteral"],postprocess:yt},{name:"BL_TimePart",symbols:["NumericExpression"],postprocess:e=>({time:e[0]})},{name:"BL_TimePart",symbols:["BL_TP_Flag"],postprocess:e=>({time:"auto",flag:e[0]})},{name:"BL_TimePart",symbols:["NumericExpression","BL_TP_Flag"],postprocess:e=>({time:e[0],flag:e[1]})},{name:"BL_TP_Flag",symbols:[{literal:"s"}],postprocess:e=>"STACCATO"},{name:"BL_TP_Flag",symbols:[{literal:"a"}],postprocess:e=>"ACCENTED"},{name:"BL_PitchPart",symbols:["BL_PP_Degree"],postprocess:yt},{name:"BL_PitchPart",symbols:["BL_PP_Chord"],postprocess:yt},{name:"BL_PP_Degree",symbols:["NumberLiteral"],postprocess:e=>({degree:e[0]})},{name:"BL_PP_Degree",symbols:["BL_PP_Anchor"],postprocess:e=>({anchor:e[0],degree:1})},{name:"BL_PP_Degree",symbols:["BL_PP_Anchor","NumberLiteral"],postprocess:e=>({anchor:e[0],degree:e[1]})},{name:"BL_PP_Chord",symbols:[{literal:"c"}],postprocess:e=>({chord:!0,degree:1})},{name:"BL_PP_Chord",symbols:["BL_PP_Degree",{literal:"c"}],postprocess:e=>({chord:!0,anchor:e[0].anchor,degree:e[0].degree})},{name:"BL_PP_Chord",symbols:[{literal:"c"},"BL_PP_Roll"],postprocess:e=>({chord:!0,roll:e[1],degree:1})},{name:"BL_PP_Chord",symbols:["BL_PP_Degree",{literal:"c"},"BL_PP_Roll"],postprocess:e=>({chord:!0,roll:e[2],anchor:e[0].anchor,degree:e[0].degree})},{name:"BL_PP_Anchor",symbols:[{literal:"k"}],postprocess:e=>"KEY"},{name:"BL_PP_Anchor",symbols:[{literal:"n"}],postprocess:e=>"NEXT"},{name:"BL_PP_Anchor",symbols:[{literal:"s"}],postprocess:e=>"STEP"},{name:"BL_PP_Anchor",symbols:[{literal:"a"}],postprocess:e=>"ARPEGGIATE"},{name:"BL_PP_Roll",symbols:[{literal:"r"}],postprocess:e=>"ROLL_UP"},{name:"BL_PP_Roll",symbols:[{literal:"r"},{literal:"d"}],postprocess:e=>"ROLL_DOWN"},{name:"BL_OctavePart",symbols:["NumberLiteral"],postprocess:yt},{name:"DrumBeatGroupLiteral",symbols:["StringLiteral","_?","BeatGroupLiteral"],postprocess:e=>new ut(e[0],e[2])},{name:"DrumBeatGroupLiteral",symbols:["StringLiteral","_?","FunctionCallExpression"],postprocess:e=>new ut(e[0],e[2])},{name:"DrumBeatLiteral",symbols:["NumberLiteral"],postprocess:e=>new $t({time:e[0]})},{name:"DrumBeatLiteral",symbols:["NumberLiteral",{literal:"a"}],postprocess:e=>new $t({time:e[0],accented:!0})},{name:"NumericExpression",symbols:["NE_addsub"],postprocess:yt},{name:"NE_parens",symbols:[{literal:"("},"NE_addsub",{literal:")"}],postprocess:e=>e[1]},{name:"NE_parens",symbols:["NumberLiteral"],postprocess:yt},{name:"NE_muldiv",symbols:["NE_muldiv",{literal:"*"},"NE_parens"],postprocess:e=>e[0]*e[2]},{name:"NE_muldiv",symbols:["NE_muldiv",{literal:"/"},"NE_parens"],postprocess:e=>e[0]/e[2]},{name:"NE_muldiv",symbols:["NE_parens"],postprocess:yt},{name:"NE_addsub",symbols:["NE_addsub",{literal:"+"},"NE_muldiv"],postprocess:e=>e[0]+e[2]},{name:"NE_addsub",symbols:["NE_addsub",{literal:"-"},"NE_muldiv"],postprocess:e=>e[0]-e[2]},{name:"NE_addsub",symbols:["NE_muldiv"],postprocess:yt},{name:"Identifier",symbols:[m.has("identifier")?{type:"identifier"}:identifier],postprocess:e=>e[0].value},{name:"NumberLiteral",symbols:[m.has("number")?{type:"number"}:number],postprocess:e=>Number(e[0].value)},{name:"NumberLiteral",symbols:[m.has("beat_number")?{type:"beat_number"}:beat_number],postprocess:e=>Number(e[0].value)},{name:"BooleanLiteral",symbols:[m.has("boolean")?{type:"boolean"}:boolean],postprocess:e=>Boolean(e[0].value)},{name:"StringLiteral",symbols:[m.has("quoted_string")?{type:"quoted_string"}:quoted_string],postprocess:e=>e[0].value.slice(1,-1)},{name:"_?$ebnf$1",symbols:["_"],postprocess:yt},{name:"_?$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_?",symbols:["_?$ebnf$1"],postprocess:()=>null},{name:"_",symbols:[m.has("ws")?{type:"ws"}:ws],postprocess:()=>null},{name:"_",symbols:[m.has("beat_ws")?{type:"beat_ws"}:beat_ws],postprocess:()=>null},{name:"_$ebnf$1",symbols:[m.has("ws")?{type:"ws"}:ws],postprocess:yt},{name:"_$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$2$subexpression$1$ebnf$1",symbols:[m.has("ws")?{type:"ws"}:ws],postprocess:yt},{name:"_$ebnf$2$subexpression$1$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$2$subexpression$1",symbols:[m.has("comment")?{type:"comment"}:comment,"_$ebnf$2$subexpression$1$ebnf$1"]},{name:"_$ebnf$2",symbols:["_$ebnf$2$subexpression$1"]},{name:"_$ebnf$2$subexpression$2$ebnf$1",symbols:[m.has("ws")?{type:"ws"}:ws],postprocess:yt},{name:"_$ebnf$2$subexpression$2$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$2$subexpression$2",symbols:[m.has("comment")?{type:"comment"}:comment,"_$ebnf$2$subexpression$2$ebnf$1"]},{name:"_$ebnf$2",symbols:["_$ebnf$2","_$ebnf$2$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"_",symbols:["_$ebnf$1","_$ebnf$2"],postprocess:()=>null},{name:"_$ebnf$3",symbols:[m.has("beat_ws")?{type:"beat_ws"}:beat_ws],postprocess:yt},{name:"_$ebnf$3",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$4$subexpression$1$ebnf$1",symbols:[m.has("beat_ws")?{type:"beat_ws"}:beat_ws],postprocess:yt},{name:"_$ebnf$4$subexpression$1$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$4$subexpression$1",symbols:[m.has("comment")?{type:"comment"}:comment,"_$ebnf$4$subexpression$1$ebnf$1"]},{name:"_$ebnf$4",symbols:["_$ebnf$4$subexpression$1"]},{name:"_$ebnf$4$subexpression$2$ebnf$1",symbols:[m.has("beat_ws")?{type:"beat_ws"}:beat_ws],postprocess:yt},{name:"_$ebnf$4$subexpression$2$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"_$ebnf$4$subexpression$2",symbols:[m.has("comment")?{type:"comment"}:comment,"_$ebnf$4$subexpression$2$ebnf$1"]},{name:"_$ebnf$4",symbols:["_$ebnf$4","_$ebnf$4$subexpression$2"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"_",symbols:["_$ebnf$3","_$ebnf$4"],postprocess:()=>null}],ParserStart:"main"};let _t=function(e){const t=new l.a.Parser(l.a.Grammar.fromCompiled(gt));return new Promise(function(n,r){try{t.feed(e)}catch(e){e.message=e.message.replace(/\t/g," "),r(e)}n(t.results)})};var xt={string_to_ast:_t,parse:function(e){return new Promise(function(t,n){_t(e).then(e=>{if(!e.length)throw new SyntaxError("Something went wrong, input not parseable.");t(e[0])})})}};t.default={load:i.a.load,PlaybackStyle:class{constructor(e){this._mainPath=e,this._ASTs=new Map,this._initialized=!1}async _loadDependencies(){let e,t=[this._mainPath];for(;e=t.pop();){let n;try{n=await i.a.load(e)}catch(t){throw new Error(`Couldn't locate imported style "${e}".`)}let r=await xt.parse(n);this._ASTs.set(e,r),r.init();for(let e of r.dependencies)this._ASTs.has(e)||t.push(e)}this._main=this._ASTs.get(this._mainPath)}_link(){this._main.link(this._ASTs)}async init(){await this._loadDependencies(),this._link(),this._initialized=!0}compile(e){if(!this._initialized)throw new Error("PlayBack style must be initialized before compiling");let t=e[Symbol.iterator](),n=t.next();console.log("nextValue",n);let r=this._main.execute(t);console.log("---final result---"),console.log(r)}async play(e){this.compile(e)}},parse:xt.parse}},function(e,t){e.exports=require("path")}]);